<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Item Master | Stark Premium ERP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css?v=4">
    <style>
        /* Specific Master Page Styles */
        .pill-filter {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid transparent;
            background: white;
            color: var(--text-muted);
            transition: all 0.2s;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .pill-filter:hover {
            background: #f8fafc;
            color: var(--text-main);
        }

        .pill-filter.active {
            background: #6366f1;
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .sku-img-thumb {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
        }

        .master-row {
            transition: transform 0.1s, background-color 0.1s;
        }

        .master-row:hover {
            transform: scale(1.005);
            background-color: #f8fafc;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            z-index: 10;
            position: relative;
        }
    </style>
</head>

<body>

    <!-- Header / Topbar -->
    <header class="topbar">
        <div class="topbar-inner">
            <a href="dashboard.html" class="logo">
                <img src="images/stark-logo.png" alt="Stark Premium">
                <span class="logo-text">Stark ERP</span>
            </a>
            <nav class="nav">
                <a class="nav-link" href="dashboard.html">Overview</a>
                <a class="nav-link active" href="master.html">Items</a>
                <a class="nav-link" href="crm.html">CRM</a>
                <a class="nav-link" href="vendor.html">Vendor</a>
                <a class="nav-link" href="purchasing.html">Purchasing</a>
                <a class="nav-link" href="inventory.html">Inventory</a>
                <a class="nav-link" href="accounting.html">Accounting</a>
                <a class="nav-link" href="orders.html">Orders</a>
                <a class="nav-link" href="logistics.html">Logistics</a>
                <a class="nav-link" href="reports.html">Reports</a>
                <a class="nav-link" href="events.html">Events</a>
            </nav>
            <div style="display:flex; align-items:center; gap:12px;">
                <div class="badge badge-green" style="display:none; @media(min-width:700px){display:inline-flex;}">
                    Online</div>
                <button class="hamburger" onclick="openMobileNav()">‚ò∞</button>
            </div>
        </div>
    </header>

    <!-- Mobile Drawer -->
    <div class="mobile-nav" id="mobileNav">
        <div class="mobile-drawer">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                <strong style="font-size:16px;">Navigation</strong>
                <button onclick="closeMobileNav()"
                    style="background:none; border:none; font-size:24px;">&times;</button>
            </div>
            <a class="mobile-link" href="dashboard.html">Overview</a>
            <a class="mobile-link active" href="master.html">Items</a>
            <a class="mobile-link" href="inventory.html">Inventory</a>
        </div>
    </div>

    <main class="container soft-ui-wrapper" style="padding-top:40px;">

        <!-- Page Header -->
        <div style="display:flex; justify-content:space-between; align-items:end; margin-bottom:32px;">
            <div>
                <h1 class="page-title" style="margin-bottom:8px;">Item Master</h1>
                <p class="page-desc">Centralized catalog for product SKUs and attributes.</p>
                <div
                    style="height:4px; width:40px; background:linear-gradient(90deg, #6366f1, transparent); border-radius:2px; margin-top:16px;">
                </div>
            </div>
            <button class="btn btn-primary" onclick="openAddModal()"
                style="background:#6366f1; border:none; box-shadow:0 4px 12px rgba(99, 102, 241, 0.3); height:48px; padding:0 24px;">
                + Create SKU
            </button>
        </div>

        <!-- KPI Header -->
        <div
            style="display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:24px; margin-bottom:32px;">
            <!-- Low Inventory -->
            <div class="card-soft" style="padding:20px; display:flex; align-items:center; gap:16px;">
                <div
                    style="width:48px; height:48px; border-radius:12px; background:#fff1f2; color:#be123c; display:flex; align-items:center; justify-content:center; font-size:20px;">
                    ÔøΩ</div>
                <div>
                    <div style="font-size:11px; font-weight:700; color:#64748b; text-transform:uppercase;">Low Inventory
                        SKUs</div>
                    <div id="kpiLow" style="font-size:24px; font-weight:800; color:#be123c;">--</div>
                </div>
            </div>

            <!-- Dead Stock Value -->
            <div class="card-soft" style="padding:20px; display:flex; align-items:center; gap:16px;">
                <div
                    style="width:48px; height:48px; border-radius:12px; background:#f1f5f9; color:#475569; display:flex; align-items:center; justify-content:center; font-size:20px;">
                    ÔøΩÔ∏è</div>
                <div>
                    <div style="font-size:11px; font-weight:700; color:#64748b; text-transform:uppercase;">Dead Stock
                        Value</div>
                    <div id="kpiDead" style="font-size:24px; font-weight:800; color:#1e293b;">--</div>
                </div>
            </div>

            <!-- Brands No Sales -->
            <div class="card-soft" style="padding:20px; display:flex; align-items:center; gap:16px;">
                <div
                    style="width:48px; height:48px; border-radius:12px; background:#fff7ed; color:#c2410c; display:flex; align-items:center; justify-content:center; font-size:20px;">
                    ‚ö†Ô∏è</div>
                <div>
                    <div style="font-size:11px; font-weight:700; color:#64748b; text-transform:uppercase;">Stagnant
                        Brands (3mo)</div>
                    <div id="kpiStagnant" style="font-size:24px; font-weight:800; color:#9a3412;">--</div>
                </div>
            </div>
        </div>

        <!-- Controls & Filters -->
        <div style="margin-bottom:24px; display:flex; flex-direction:column; gap:16px;">

            <!-- Search & Basic -->
            <div class="card-soft" style="padding:12px; display:flex; gap:12px; align-items:center;">
                <div style="position:relative; flex:1;">
                    <span
                        style="position:absolute; left:16px; top:50%; transform:translateY(-50%); opacity:0.4;">üîç</span>
                    <input id="qSearch" class="input" placeholder="Search by SKU, Name, or Brand..." oninput="render()"
                        style="padding-left:42px; height:48px; border:none; background:#f8fafc; font-size:14px;">
                </div>
                <div style="width:1px; height:24px; background:#e2e8f0;"></div>
                <button class="btn btn-secondary" onclick="exportData()" style="height:48px; padding:0 20px;">Export
                    CSV</button>
            </div>

            <!-- Dynamic Pills -->
            <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
                <div style="font-size:12px; font-weight:700; color:#64748b; margin-right:8px;">STATUS:</div>
                <div class="pill-filter active" onclick="setFilter(this, '')">All</div>
                <div class="pill-filter" onclick="setFilter(this, 'Live')">Live</div>
                <div class="pill-filter" onclick="setFilter(this, 'Fashion')">Fashion</div>
                <div class="pill-filter" onclick="setFilter(this, 'Internal Use')">Internal</div>
                <div class="pill-filter" onclick="setFilter(this, 'Discontinued')">Discontinued</div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="card-soft table-container" style="padding:0; overflow:hidden;">
            <table id="itemTable">
                <thead>
                    <tr
                        style="background:#f8fafc; text-transform:uppercase; font-size:11px; letter-spacing:0.8px; color:#64748b;">
                        <th style="padding:16px 24px;">Image</th>
                        <th style="padding:16px;">Product Info</th>
                        <th style="padding:16px;">Brand / Vendor</th>
                        <th style="padding:16px;">Category</th>
                        <th style="padding:16px;">Status</th>
                        <th style="padding:16px; text-align:right;">OH</th>
                        <th style="padding:16px; text-align:right;">Hold</th>
                        <th style="padding:16px;">Cost</th>
                        <th style="padding:16px;">Actions</th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>
        </div>

        <div style="padding:40px; text-align:center; color:var(--text-muted); font-size:13px;">
            &copy; 2026 Stark Premium ERP
        </div>

    </main>

    <!-- Add Item Modal -->
    <div class="mobile-nav" id="itemModal"
        style="z-index:900; display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center;">
        <div class="card"
            style="width:min(90%, 600px); max-height:90vh; overflow-y:auto; box-shadow:var(--shadow-card); padding:32px; background:white; border-radius:16px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:24px;">
                <h2 style="margin:0; font-size:20px;">SKU Details</h2>
                <button onclick="closeModal()"
                    style="border:none; background:transparent; font-size:24px; cursor:pointer; color:#94a3b8;">&times;</button>
            </div>

            <div style="display:grid; gap:20px;">

                <!-- Image Input -->
                <div style="display:flex; gap:16px; align-items:center;">
                    <div id="imgPreview"
                        style="width:64px; height:64px; border-radius:12px; background:#f1f5f9; border:1px solid #e2e8f0; display:flex; align-items:center; justify-content:center; color:#cbd5e1; font-size:24px; overflow:hidden;">
                        üì∑
                    </div>
                    <div style="flex:1;">
                        <label
                            style="font-size:12px; font-weight:700; color:#64748b; text-transform:uppercase; display:block; margin-bottom:6px;">Image
                            URL</label>
                        <input id="iImg" class="input" placeholder="https://..." oninput="updatePreview(this.value)">
                    </div>
                </div>

                <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                    <div>
                        <label
                            style="font-size:12px; font-weight:700; color:#64748b; text-transform:uppercase; display:block; margin-bottom:6px;">SKU</label>
                        <input id="iSku" class="input" placeholder="e.g. A-101">
                    </div>
                    <div>
                        <label
                            style="font-size:12px; font-weight:700; color:#64748b; text-transform:uppercase; display:block; margin-bottom:6px;">Model
                            #</label>
                        <input id="iModel" class="input" placeholder="e.g. M-202X">
                    </div>
                </div>

                <div>
                    <label
                        style="font-size:12px; font-weight:700; color:#64748b; text-transform:uppercase; display:block; margin-bottom:6px;">Title
                        / Name</label>
                    <input id="iName" class="input" placeholder="Product Name">
                </div>

                <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                    <div>
                        <label
                            style="font-size:12px; font-weight:700; color:#64748b; text-transform:uppercase; display:block; margin-bottom:6px;">Brand</label>
                        <select id="iBrand" class="input">
                            <option>Stark Mfg</option>
                            <option>LuxeGold</option>
                            <option>Urban Wear</option>
                            <option>TechNova</option>
                        </select>
                    </div>
                    <div>
                        <label
                            style="font-size:12px; font-weight:700; color:#64748b; text-transform:uppercase; display:block; margin-bottom:6px;">Status</label>
                        <select id="iStatus" class="input">
                            <option value="Live">Live</option>
                            <option value="Fashion">Fashion</option>
                            <option value="Feeds Only">Feeds Only</option>
                            <option value="Internal Use">Internal Use</option>
                            <option value="Discontinued">Discontinued</option>
                            <option value="Presentation">Presentation</option>
                        </select>
                    </div>
                </div>

                <div
                    style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:20px; background:#f8fafc; padding:16px; border-radius:12px;">
                    <div>
                        <label style="font-size:11px; font-weight:700; color:#64748b;">Cost</label>
                        <input id="iCost" class="input" type="number" step="0.01">
                    </div>
                    <div>
                        <label style="font-size:11px; font-weight:700; color:#64748b;">On Hand</label>
                        <input id="iOn" class="input" type="number" value="0">
                    </div>
                    <div>
                        <label style="font-size:11px; font-weight:700; color:#64748b;">Hold</label>
                        <input id="iHold" class="input" type="number" value="0">
                    </div>
                </div>

                <div style="display:flex; justify-content:flex-end; gap:12px; margin-top:12px;">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveItem()" style="background:#6366f1; border:none;">Save
                        SKU</button>
                </div>
            </div>

        </div>
    </div>

    <div id="toastWrap" style="position:fixed; bottom:20px; right:20px; z-index:9999; display:grid; gap:10px;"></div>

    <script src="erp.js"></script>
    <script>
        const ITEM_KEY = "stark_erp_items_v2";
        let activeStatus = '';

        function loadItems() { try { return JSON.parse(localStorage.getItem(ITEM_KEY) || "[]"); } catch { return []; } }
        function saveItems(list) { localStorage.setItem(ITEM_KEY, JSON.stringify(list)); }

        // Seed Data
        (function seed() {
            const items = loadItems();
            if (items.length < 5) {
                const demo = [
                    { sku: "BX-9001", image: "https://placehold.co/100/e0e7ff/6366f1?text=BX", model: "BX-900", name: "Premium Gift Box", brand: "Stark Mfg", vendor: "PackPro", status: "Live", cat: "Packaging", on: 140, hold: 10, cost: 1.60, lastSale: "2026-01-20" },
                    { sku: "NK-1001", image: "https://placehold.co/100/fce7f3/be123c?text=NK", model: "NK-AUR", name: "Necklace ‚Äî Aurora", brand: "LuxeGold", vendor: "GoldSmiths", status: "Fashion", cat: "Jewelry", on: 62, hold: 0, cost: 42.00, lastSale: "2025-10-01" }, // > 3 months
                    { sku: "RG-2001", image: "https://placehold.co/100/fef3c7/b45309?text=RG", model: "RG-OBS", name: "Ring ‚Äî Obsidian", brand: "LuxeGold", vendor: "GoldSmiths", status: "Presentation", cat: "Jewelry", on: 0, hold: 2, cost: 38.00, lastSale: "2025-09-15" },
                    { sku: "TS-5544", image: "https://placehold.co/100/f1f5f9/64748b?text=TS", model: "TS-VNT", name: "Vintage Tee", brand: "Urban Wear", vendor: "Textico", status: "Discontinued", cat: "Apparel", on: 12, hold: 0, cost: 8.50, lastSale: "2024-01-01" }, // Dead
                    { sku: "IP-1234", image: "https://placehold.co/100/dbeafe/1e40af?text=IP", model: "16-PM", name: "iPhone 16 Pro Max", brand: "TechNova", vendor: "Apple Dist", status: "Live", cat: "Electronics", on: 5, hold: 5, cost: 1099.00, lastSale: "2026-01-22" }
                ];
                saveItems([...demo, ...items]);
            }
        })();

        // Filter Logic
        function setFilter(el, status) {
            document.querySelectorAll('.pill-filter').forEach(e => e.classList.remove('active'));
            el.classList.add('active');
            activeStatus = status;
            render();
        }

        function render() {
            const list = loadItems();
            const q = (document.getElementById("qSearch").value || "").toLowerCase();

            const tbody = document.getElementById("tbody");
            tbody.innerHTML = "";

            const filtered = list.filter(i => {
                if (activeStatus && i.status !== activeStatus) return false;
                if (q) {
                    const txt = [i.sku, i.model, i.name].join(" ").toLowerCase();
                    if (!txt.includes(q)) return false;
                }
                return true;
            });

            // Update KPIs
            // Low Inventory: on < 10
            document.getElementById("kpiLow").textContent = list.filter(i => i.on < 10 && i.status === 'Live').length;

            // Dead Stock: No sales in 3 months (90 days)
            const today = new Date();
            const ninetyDaysAgo = new Date(today.getTime() - (90 * 24 * 60 * 60 * 1000));

            const deadItems = list.filter(i => {
                if (!i.lastSale) return false; // Assume new if no date, or treat as dead? Treating as safe for now.
                return new Date(i.lastSale) < ninetyDaysAgo;
            });
            const deadValue = deadItems.reduce((acc, i) => acc + (i.on * i.cost), 0);
            document.getElementById("kpiDead").textContent = window.formatMoney(deadValue);

            // Stagnant Brands: Brands where ALL items have no sales in 3 months
            const brands = [...new Set(list.map(i => i.brand).filter(Boolean))];
            let stagnantCount = 0;

            brands.forEach(b => {
                const bItems = list.filter(i => i.brand === b);
                if (bItems.length === 0) return;

                const allStale = bItems.every(i => {
                    if (!i.lastSale) return true; // No sale ever = stale
                    return new Date(i.lastSale) < ninetyDaysAgo;
                });

                if (allStale) stagnantCount++;
            });

            document.getElementById("kpiStagnant").textContent = stagnantCount;

            if (filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="9" style="text-align:center; padding:40px; color:var(--text-muted); font-size:14px;">No items match your search.</td></tr>`;
                return;
            }

            filtered.forEach(i => {
                const tr = document.createElement("tr");
                tr.className = "master-row";
                tr.style.borderBottom = "1px solid #f1f5f9";
                tr.onclick = (e) => {
                    if (e.target.tagName === 'BUTTON') return;
                    // window.location.href = `item_detail.html?sku=${i.sku}`; // Keeping simple for now
                    editItem(i.sku);
                };

                let sClass = "status-live";
                if (i.status === "Fashion") sClass = "status-fashion";
                if (i.status === "Internal Use") sClass = "status-internal";
                if (i.status === "Discontinued") sClass = "status-discontinued";
                if (i.status === "Feeds Only") sClass = "status-feeds";
                if (i.status === "Presentation") sClass = "status-presentation";

                const imgUrl = i.image || `https://placehold.co/40/e2e8f0/94a3b8?text=${i.sku.substring(0, 2)}`;

                tr.innerHTML = `
                <td style="padding:16px 24px;">
                    <img src="${imgUrl}" class="sku-img-thumb" alt="SKU">
                </td>
                <td style="padding:16px;">
                    <div style="font-weight:700; font-size:14px; color:#1e293b; margin-bottom:2px;">${i.sku}</div>
                    <div style="font-size:13px; color:#64748b; margin-bottom:2px;">${i.name}</div>
                    <div style="font-size:11px; color:#94a3b8;">${i.model || "‚Äî"}</div>
                </td>
                <td style="padding:16px;">
                    <div style="font-weight:600; font-size:13px; color:#334155;">${i.brand || "‚Äî"}</div>
                    <div style="font-size:11px; color:#94a3b8;">${i.vendor || "‚Äî"}</div>
                </td>
                <td style="padding:16px; font-size:13px; color:#475569;">${i.cat || "‚Äî"}</td>
                <td style="padding:16px;"><span class="status-badge ${sClass}">${i.status}</span></td>
                <td style="padding:16px; text-align:right; font-weight:600; color:#334155;">${i.on}</td>
                <td style="padding:16px; text-align:right; color:#f59e0b; font-weight:600;">${i.hold || 0}</td>
                <td style="padding:16px; font-variant-numeric: tabular-nums;">${window.formatMoney(i.cost)}</td>
                <td style="padding:16px;">
                    <button class="btn btn-secondary" style="height:32px; font-size:12px; border-radius:8px;" onclick="editItem('${i.sku}')">Edit</button>
                </td>
            `;
                tbody.appendChild(tr);
            });
        }



        function openAddModal() {
            // Deprecated for creating new items, but used for edit?
            // If used for edit, ensure we clear/set values
            document.getElementById("itemModal").style.display = "flex";
        }
        function closeModal() { document.getElementById("itemModal").style.display = "none"; }

        function editItem(sku) {
            const list = loadItems();
            const i = list.find(x => x.sku === sku);
            if (i) {
                document.getElementById("iSku").value = i.sku;
                document.getElementById("iModel").value = i.model || "";
                document.getElementById("iName").value = i.name;
                document.getElementById("iBrand").value = i.brand || "Stark Mfg";
                document.getElementById("iStatus").value = i.status || "Live";
                document.getElementById("iImg").value = i.image || "";
                updatePreview(i.image);
                document.getElementById("iOn").value = i.on;
                document.getElementById("iHold").value = i.hold || 0;
                document.getElementById("iCost").value = i.cost;
                document.getElementById("itemModal").style.display = "flex";
            }
        }

        function exportData() {
            const list = loadItems();
            let csv = "SKU,Model,Name,Brand,Status,On Hand,Cost\n";
            list.forEach(i => {
                csv += `${i.sku},${i.model},${i.name},${i.brand},${i.status},${i.on},${i.cost}\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = "master_export.csv";
            a.click();
            toast("Export", "CSV Downloaded");
        }

        render();
    </script>
</body>

</html>
```
