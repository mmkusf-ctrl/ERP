<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Inventory | Stark Premium ERP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="erp.css">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <header class="topbar">
    <div class="topbar-inner">
      <a href="dashboard.html" class="logo">
        <img src="images/stark-logo.png" alt="Stark Premium">
        <span class="logo-text">Stark ERP</span>
      </a>

      <nav class="nav">
        <a class="nav-link" href="dashboard.html">Home</a>
        <a class="nav-link" href="master.html">Master</a>
        <a class="nav-link" href="crm.html">CRM</a>
        <a class="nav-link" href="vendor.html">Vendor</a>
        <a class="nav-link" href="purchasing.html">Purchasing</a>
        <a class="nav-link active" href="inventory.html">Inventory</a>
        <a class="nav-link" href="accounting.html">Accounting</a>
        <a class="nav-link" href="orders.html">Orders</a>
        <a class="nav-link" href="logistics.html">Logistics</a>
        <a class="nav-link" href="reports.html">Reports</a>
        <a class="nav-link" href="events.html">Events</a>
      </nav>

      <div style="display:flex; align-items:center; gap:12px;">
        <div class="badge badge-green" style="display:none; @media(min-width:700px){display:inline-flex;}">
          Online
        </div>
        <button class="hamburger" onclick="openMobileNav()">
          <span></span><span></span><span></span>
        </button>
      </div>
    </div>
  </header>

  <div class="mobile-nav" id="mobileNav">
    <div class="mobile-drawer">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
        <strong style="font-size:16px;">Navigation</strong>
        <button onclick="closeMobileNav()"
          style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
      </div>
      <a class="mobile-link" href="dashboard.html">Home</a>
      <a class="mobile-link" href="master.html">Master</a>
      <a class="mobile-link" href="crm.html">CRM</a>
      <a class="mobile-link" href="vendor.html">Vendor</a>
      <a class="mobile-link" href="purchasing.html">Purchasing</a>
      <a class="mobile-link active" href="inventory.html">Inventory</a>
      <a class="mobile-link" href="accounting.html">Accounting</a>
      <a class="mobile-link" href="orders.html">Orders</a>
      <a class="mobile-link" href="logistics.html">Logistics</a>
      <a class="mobile-link" href="reports.html">Reports</a>
      <a class="mobile-link" href="events.html">Events</a>
      <a class="mobile-link" href="trends.html">Trends</a>
    </div>
  </div>


  <main class="container soft-ui-wrapper">
    <!-- Page Title -->
    <div style="margin-bottom:32px;">
      <h1 class="page-title" style="margin-bottom:8px;">Inventory Operations</h1>
      <p class="page-desc" style="max-width:600px;">Manage stock levels, process inbound shipments, and maintain
        accuracy.</p>
      <div class="gold-line" style="margin:16px 0 0; width:40px;"></div>
    </div>

    <!-- Soft KPI Grid -->
    <!-- Soft KPI Grid -->
    <div class="kpi-row-soft" style="grid-template-columns: repeat(2, 1fr);">
      <!-- Card 2: Low Stock -->
      <!-- Card 2: Low Stock -->
      <div class="kpi-card-soft clickable-kpi" style="border-left:4px solid #f59e0b;" onclick="setFilter('low', this)">
        <div class="label">
          <span>Low Stock</span>
          <span class="badge-soft" style="background:#fef3c7; color:#b45309;">Warning</span>
        </div>
        <div class="val" id="kLow">0</div>
        <div style="font-size:11px; font-weight:700; color:#b45309;">REORDER SOON</div>
      </div>

      <!-- Card 3: Out of Stock -->
      <div class="kpi-card-soft clickable-kpi" style="border-left:4px solid #ef4444;" onclick="setFilter('oos', this)">
        <div class="label">
          <span>Out of Stock</span>
          <span class="badge-soft" style="background:#fee2e2; color:#b91c1c;">Critical</span>
        </div>
        <div class="val" id="kOOS">0</div>
        <div style="font-size:11px; font-weight:700; color:#b91c1c;">RESTOCK ASAP</div>
      </div>
    </div>

    <style>
      .btn-action-soft {
        width: 100%;
        margin-top: 16px;
        justify-content: center;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        font-weight: 600;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        color: var(--text-muted);
      }

      .btn-action-soft:hover {
        background: white;
        border-color: var(--primary);
        color: var(--primary);
        box-shadow: 0 4px 12px rgba(225, 29, 72, 0.15);
        transform: translateY(-2px);
      }

      .btn-action-soft:active {
        transform: translateY(0);
      }
    </style>

    <!-- Quick Actions (Soft Style) -->
    <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:20px; margin-bottom:40px;">

      <!-- Receive -->
      <div class="card-soft"
        style="padding:24px; display:flex; flex-direction:column; justify-content:space-between; min-height:160px; border-color:white; box-shadow:0 4px 6px rgba(0,0,0,0.02);">
        <div>
          <div style="display:flex; align-items:center; gap:10px; margin-bottom:12px; font-weight:700; font-size:15px;">
            <div
              style="width:32px; height:32px; background:#eff6ff; color:#3b82f6; border-radius:8px; display:flex; align-items:center; justify-content:center;">
              <i class="fa-solid fa-box-open"></i>
            </div>
            Receive Inventory
          </div>
          <p style="font-size:13px; color:var(--text-muted); line-height:1.5;">Process specific items for all POs
            arrival.</p>
        </div>
        <button class="btn btn-secondary btn-action-soft" onclick="window.location.href='inventory_receive.html'">
          Start Reception
        </button>
      </div>

      <!-- Adjust -->
      <div class="card-soft"
        style="padding:24px; display:flex; flex-direction:column; justify-content:space-between; min-height:160px; border-color:white; box-shadow:0 4px 6px rgba(0,0,0,0.02);">
        <div>
          <div style="display:flex; align-items:center; gap:10px; margin-bottom:12px; font-weight:700; font-size:15px;">
            <div
              style="width:32px; height:32px; background:#fff7ed; color:#f97316; border-radius:8px; display:flex; align-items:center; justify-content:center;">
              <i class="fa-solid fa-gear"></i>
            </div>
            Adjust Stock
          </div>
          <p style="font-size:13px; color:var(--text-muted); line-height:1.5;">Manual adjustments for damage, loss, or
            extras.</p>
        </div>
        <button class="btn btn-secondary btn-action-soft" onclick="window.location.href='inventory_adjust.html'">
          Adjust Now
        </button>
      </div>

      <!-- Count -->
      <div class="card-soft"
        style="padding:24px; display:flex; flex-direction:column; justify-content:space-between; min-height:160px; border-color:white; box-shadow:0 4px 6px rgba(0,0,0,0.02);">
        <div>
          <div style="display:flex; align-items:center; gap:10px; margin-bottom:12px; font-weight:700; font-size:15px;">
            <div
              style="width:32px; height:32px; background:#f0fdf4; color:#22c55e; border-radius:8px; display:flex; align-items:center; justify-content:center;">
              <i class="fa-solid fa-clipboard-list"></i>
            </div>
            Cycle Count
          </div>
          <p style="font-size:13px; color:var(--text-muted); line-height:1.5;">Verify physical stock accuracy by zone.
          </p>
        </div>
        <button class="btn btn-secondary btn-action-soft" onclick="window.location.href='inventory_count.html'">
          Start Count
        </button>
      </div>
    </div>


    <!-- Directory Table (Full Width) -->
    <div class="card-soft" style="padding:0; overflow:hidden; min-height:500px;">
      <div
        style="padding:24px; border-bottom:1px solid #f1f5f9; display:flex; justify-content:space-between; align-items:center;">
        <div style="display:flex; gap:16px; align-items:center;">
          <h3 style="font-size:16px; margin:0; font-weight:700;">Incoming & Stock</h3>
          <!-- View Switcher Pills -->
          <div style="background:#f1f5f9; padding:4px; border-radius:8px; display:flex; gap:4px;">
            <button id="tabPos" class="view-tab active" onclick="switchView('pos')"
              style="padding:6px 12px; border-radius:6px; border:none; background:white; font-size:12px; font-weight:600; cursor:pointer; box-shadow:0 1px 2px rgba(0,0,0,0.05);">Deliveries</button>
            <button id="tabItems" class="view-tab" onclick="switchView('items')"
              style="padding:6px 12px; border-radius:6px; border:none; background:transparent; font-size:12px; font-weight:600; cursor:pointer; color:var(--text-muted);">Stock
              Items</button>
          </div>
        </div>

        <input type="text" placeholder="Search..." class="input"
          style="background:#f8fafc; border-color:#e2e8f0; width:240px; height:36px; padding-left:36px; background-image:url('data:image/svg+xml;charset=UTF-8,<svg xmlns=\'http://www.w3.org/2000/svg\' fill=\'%2394a3b8\' viewBox=\'0 0 16 16\'><path d=\'M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z\'/></svg>'); background-repeat:no-repeat; background-position:10px center;"
          onkeyup="renderItems()">
      </div>

      <!-- View: POs -->
      <div id="view-pos" class="table-wrap">
        <table style="width:100%; border-collapse:collapse;">
          <thead>
            <tr style="background:#f8fafc; border-bottom:1px solid #e2e8f0;">
              <th
                style="text-align:left; padding:16px 24px; font-size:11px; text-transform:uppercase; color:var(--text-muted); font-weight:700;">
                ETA</th>
              <th
                style="text-align:left; padding:16px 24px; font-size:11px; text-transform:uppercase; color:var(--text-muted); font-weight:700;">
                PO #</th>
              <th
                style="text-align:left; padding:16px 24px; font-size:11px; text-transform:uppercase; color:var(--text-muted); font-weight:700;">
                Vendor</th>
              <th
                style="text-align:left; padding:16px 24px; font-size:11px; text-transform:uppercase; color:var(--text-muted); font-weight:700;">
                Items</th>
              <th
                style="text-align:left; padding:16px 24px; font-size:11px; text-transform:uppercase; color:var(--text-muted); font-weight:700;">
                Status</th>
              <th
                style="text-align:right; padding:16px 24px; font-size:11px; text-transform:uppercase; color:var(--text-muted); font-weight:700;">
                Action</th>
            </tr>
          </thead>
          <tbody id="poBody">
            <!-- Injected -->
          </tbody>
        </table>
      </div>

      <!-- View: Items -->
      <div id="view-items" class="table-wrap" style="display:none;">
        <table style="width:100%; border-collapse:collapse;">
          <thead>
            <tr style="background:#f8fafc; border-bottom:1px solid #e2e8f0;">
              <th
                style="text-align:left; padding:16px 24px; font-size:11px; text-transform:uppercase; color:var(--text-muted); font-weight:700;">
                SKU</th>
              <th
                style="text-align:left; padding:16px 24px; font-size:11px; text-transform:uppercase; color:var(--text-muted); font-weight:700;">
                Name</th>
              <th
                style="text-align:left; padding:16px 24px; font-size:11px; text-transform:uppercase; color:var(--text-muted); font-weight:700;">
                Category</th>
              <th
                style="text-align:left; padding:16px 24px; font-size:11px; text-transform:uppercase; color:var(--text-muted); font-weight:700;">
                Stock / ROP</th>
              <th
                style="text-align:left; padding:16px 24px; font-size:11px; text-transform:uppercase; color:var(--text-muted); font-weight:700;">
                Last Sale</th>
              <th
                style="text-align:left; padding:16px 24px; font-size:11px; text-transform:uppercase; color:var(--text-muted); font-weight:700;">
                Value</th>
              <th
                style="text-align:right; padding:16px 24px; font-size:11px; text-transform:uppercase; color:var(--text-muted); font-weight:700;">
                Action</th>
            </tr>
          </thead>
          <tbody id="itemBody">
            <!-- Injected -->
          </tbody>
        </table>
      </div>

    </div>
  </main>

  <!-- Add Item Modal -->
  <div class="modal" id="itemModal">
    <div class="modal-card">
      <div class="modal-head">
        <h3>Add Inventory Item</h3>
        <button class="x" onclick="closeItemModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="controls">
          <input id="iSku" class="input" placeholder="SKU (required)" />
          <input id="iName" class="input" placeholder="Item name (required)" />
          <input id="iCat" class="input" placeholder="Category (e.g., Packaging)" />
          <input id="iWh" class="input" placeholder="Warehouse (e.g., WH-A)" />
        </div>
        <div class="controls" style="margin-top:10px;">
          <input id="iSup" class="input" placeholder="Supplier (e.g., PackPro)" />
          <input id="iOn" class="input" placeholder="On-hand" type="number" />
          <input id="iRop" class="input" placeholder="Reorder point" type="number" />
          <input id="iCost" class="input" placeholder="Unit cost" type="number" step="0.01" />
        </div>
      </div>
      <div class="modal-head" style="border-top:1px solid rgba(11,18,32,0.10);">
        <div style="color:#667085;font-size:12px;">Saved to localStorage</div>
        <div style="display:flex;gap:10px;">
          <button class="btn secondary" onclick="closeItemModal()">Cancel</button>
          <button class="btn" onclick="addItem()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create PO Modal -->
  <div class="modal" id="poModal">
    <div class="modal-card">
      <div class="modal-head">
        <h3>Create Purchase Order</h3>
        <button class="x" onclick="closePOModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="controls">
          <input id="pVendor" class="input" placeholder="Vendor (required)" />
          <input id="pWh" class="input" placeholder="Warehouse (e.g., WH-A)" />
          <input id="pEta" class="input" type="date" />
          <select id="pStatus">
            <option>Open</option>
            <option>Awaiting approval</option>
            <option>Confirmed</option>
            <option>Delayed</option>
          </select>
        </div>
        <div style="margin-top:10px;">
          <textarea id="pLines" placeholder="PO lines (one per line): SKU,Qty   Example: BX-9001,100"></textarea>
        </div>
      </div>
      <div class="modal-head" style="border-top:1px solid rgba(11,18,32,0.10);">
        <div style="color:#667085;font-size:12px;">Saved to localStorage</div>
        <div style="display:flex;gap:10px;">
          <button class="btn secondary" onclick="closePOModal()">Cancel</button>
          <button class="btn" onclick="createPO()">Create</button>
        </div>
      </div>
    </div>
  </div>

  <script src="erp.js"></script>
  <script>
    requireAuth();
    setActiveNav("inventory.html");

    const ITEM_KEY = "stark_erp_items_v2";
    const PO_KEY = "stark_erp_pos_v1";
    let ACTIVE_FILTER = 'all';

    function load(key, fallback) {
      try { return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }
      catch { return fallback; }
    }
    function save(key, data) { localStorage.setItem(key, JSON.stringify(data)); }
    function money(n) {
      const v = Number(n || 0);
      return v.toLocaleString(undefined, { style: "currency", currency: "USD" });
    }
    function daysAgo(dateStr) {
      if (!dateStr) return 9999;
      const ms = Date.now() - new Date(dateStr).getTime();
      return Math.floor(ms / (1000 * 60 * 60 * 24));
    }

    function openItemModal() { document.getElementById("itemModal").classList.add("open"); }
    function closeItemModal() { document.getElementById("itemModal").classList.remove("open"); }
    function openPOModal() { document.getElementById("poModal").classList.add("open"); }
    function closePOModal() { document.getElementById("poModal").classList.remove("open"); }

    function switchView(view) {
      document.getElementById('view-pos').style.display = 'none';
      document.getElementById('view-items').style.display = 'none';
      document.getElementById(`view-${view}`).style.display = 'block';

      // Update Tabs
      document.querySelectorAll('.view-tab').forEach(el => {
        el.classList.remove('active');
        el.style.background = 'transparent';
        el.style.color = 'var(--text-muted)';
        el.style.boxShadow = 'none';
      });

      const activeTab = document.getElementById(view === 'pos' ? 'tabPos' : 'tabItems');
      if (activeTab) {
        activeTab.classList.add('active');
        activeTab.style.background = 'white';
        activeTab.style.color = 'var(--text-main)';
        activeTab.style.boxShadow = '0 1px 2px rgba(0,0,0,0.05)';
      }

      if (view === 'items') renderItems();
      else renderPOs();
    }

    function loadDemoItems() {
      const now = new Date();
      const demo = [
        { sku: "BX-9001", name: "Premium Gift Box", cat: "Packaging", wh: "WH-A", sup: "PackPro", on: 140, rop: 50, cost: 1.60, lastSale: new Date(now - 86400000 * 2).toISOString() },
        { sku: "LB-3001", name: "Luxury Label Set", cat: "Packaging", wh: "WH-A", sup: "PackPro", on: 18, rop: 25, cost: 0.75, lastSale: new Date(now - 86400000 * 5).toISOString() },
        { sku: "NK-1001", name: "Necklace — Aurora", cat: "Finished Goods", wh: "WH-B", sup: "Stark Mfg", on: 62, rop: 30, cost: 42.00, lastSale: new Date(now - 86400000 * 120).toISOString() },
        { sku: "RG-2001", name: "Ring — Obsidian", cat: "Finished Goods", wh: "WH-B", sup: "Stark Mfg", on: 0, rop: 18, cost: 38.00, lastSale: new Date(now - 86400000 * 10).toISOString() },
        { sku: "ER-4040", name: "Earrings — Halo", cat: "Finished Goods", wh: "WH-B", sup: "Stark Mfg", on: 24, rop: 20, cost: 16.50, lastSale: new Date(now - 86400000 * 45).toISOString() },
        { sku: "GL-5000", name: "Gold Leaf Sheets", cat: "Raw Material", wh: "WH-C", sup: "GoldSource", on: 500, rop: 100, cost: 0.20, lastSale: new Date(now - 86400000 * 200).toISOString() }
      ];
      save(ITEM_KEY, demo);
      toast("Loaded demo", "Inventory demo items loaded.");
      renderKpis();
    }

    function addItem() {
      const sku = (document.getElementById("iSku").value || "").trim();
      const name = (document.getElementById("iName").value || "").trim();
      if (!sku || !name) return toast("Missing fields", "SKU and Item name are required.");

      const item = {
        sku,
        name,
        cat: (document.getElementById("iCat").value || "").trim() || "General",
        wh: (document.getElementById("iWh").value || "").trim() || "WH-A",
        sup: (document.getElementById("iSup").value || "").trim() || "Vendor",
        on: Number(document.getElementById("iOn").value || 0),
        rop: Number(document.getElementById("iRop").value || 0),
        cost: Number(document.getElementById("iCost").value || 0),
        lastSale: new Date().toISOString()
      };

      const list = load(ITEM_KEY, []);
      if (list.some(x => (x.sku || "").toUpperCase() === sku.toUpperCase())) {
        return toast("Duplicate SKU", "This SKU already exists.");
      }
      list.unshift(item);
      save(ITEM_KEY, list);
      closeItemModal();
      toast("Item added", `${sku} saved.`);
      renderKpis();
    }

    function setFilter(mode, el) {
      if (ACTIVE_FILTER === mode) {
        ACTIVE_FILTER = 'all';
        document.querySelectorAll('.kpi-card-soft').forEach(c => {
          c.style.transform = "";
          c.style.boxShadow = "";
        });
        toast("Filter Cleared", "Showing all items");
      } else {
        ACTIVE_FILTER = mode;
        document.querySelectorAll('.kpi-card-soft').forEach(c => {
          c.style.transform = "";
          c.style.boxShadow = "";
        });
        el.style.transform = "translateY(-4px)";
        el.style.boxShadow = "var(--shadow-lg)";
        toast("Filter Active", mode === 'low' ? "Showing low stock (< 3)" : "Showing out of stock");
      }

      // Ensure we are on items view
      const itemsTab = document.getElementById('tabItems');
      if (itemsTab) {
        switchView('items');
      }
      renderItems();
    }

    function renderKpis() {
      const items = load(ITEM_KEY, []);
      const pos = load(PO_KEY, []);

      const totalSkus = items.length;
      const low = items.filter(i => Number(i.on) <= Number(i.rop) && Number(i.on) > 0).length;
      const oos = items.filter(i => Number(i.on) <= 0).length;
      const totalVal = items.reduce((sum, i) => sum + (Number(i.on) * Number(i.cost)), 0);

      const elSku = document.getElementById("kSku");
      const elLow = document.getElementById("kLow");
      const elOOS = document.getElementById("kOOS");
      const elDead = document.getElementById("kDead");

      if (elSku) elSku.textContent = String(totalSkus);
      if (elLow) elLow.textContent = String(low);
      if (elOOS) elOOS.textContent = String(oos);
      if (elDead) elDead.textContent = money(totalVal);
    }

    function createPO() {
      const vendor = (document.getElementById("pVendor").value || "").trim();
      if (!vendor) return toast("Missing field", "Vendor is required.");

      const po = {
        id: "PO-" + Math.floor(1000 + Math.random() * 9000),
        vendor,
        wh: (document.getElementById("pWh").value || "").trim() || "WH-A",
        eta: (document.getElementById("pEta").value || "").trim(),
        status: document.getElementById("pStatus").value,
        lines: (document.getElementById("pLines").value || "").trim(),
        createdAt: Date.now()
      };

      const list = load(PO_KEY, []);
      list.unshift(po);
      save(PO_KEY, list);
      closePOModal();
      toast("PO created", `${po.id} saved.`);
      renderPOs();
    }

    function renderPOs() {
      const pos = load(PO_KEY, []);
      const tbody = document.getElementById("poBody");
      if (pos.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:20px; color:var(--muted);">No Purchase Orders found.</td></tr>';
        return;
      }
      tbody.innerHTML = pos.map((p, i) => `
           <tr style="animation: fadeInUp 0.3s ease-out forwards; animation-delay: ${i * 0.05}s; border-bottom:1px solid #f1f5f9; transition:background 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
              <td style="padding:16px 24px; font-size:13px; color:var(--text-muted);">${p.eta || "-"}</td>
              <td style="padding:16px 24px; font-size:13px; font-weight:600; color:var(--text-main);">${p.id}</td>
              <td style="padding:16px 24px; font-size:13px; color:var(--text-main);">${p.vendor}</td>
              <td style="padding:16px 24px; font-size:13px; color:var(--text-muted);">${(p.lines || "").split('\n').length} items</td>
              <td style="padding:16px 24px; font-size:13px;"><span class="badge ${getStatusStyle(p.status)}" style="padding:4px 10px; border-radius:99px; font-size:11px; font-weight:600;">${p.status}</span></td>
              <td style="padding:16px 24px; text-align:right;"><button class="btn btn-secondary" style="height:32px; padding:0 12px; font-size:12px; font-weight:600;" onclick="window.location.href='inventory_receive.html'">Receive</button></td>
           </tr>
        `).join("");
    }

    function renderItems() {
      let items = load(ITEM_KEY, []);
      const search = document.getElementById("itemSearch").value.toLowerCase();
      if (search) items = items.filter(i => i.name.toLowerCase().includes(search) || i.sku.toLowerCase().includes(search));

      if (ACTIVE_FILTER === 'low') {
        items = items.filter(i => Number(i.on) < 3);
      }
      if (ACTIVE_FILTER === 'oos') {
        items = items.filter(i => Number(i.on) <= 0);
      }

      const tbody = document.getElementById("itemBody");
      if (items.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:20px; color:var(--muted);">No items found.</td></tr>';
        return;
      }
      tbody.innerHTML = items.map((i, idx) => `
           <tr style="animation: fadeInUp 0.3s ease-out forwards; animation-delay: ${idx * 0.05}s; border-bottom:1px solid #f1f5f9; transition:background 0.2s;" onmouseover="this.style.background='#f8fafc'" onmouseout="this.style.background='transparent'">
              <td style="padding:16px 24px; font-size:13px; font-weight:600; color:var(--text-main);">${i.sku}</td>
              <td style="padding:16px 24px; font-size:13px; color:var(--text-main);">${i.name}</td>
              <td style="padding:16px 24px; font-size:13px; color:var(--text-muted);">${i.cat}</td>
              <td style="padding:16px 24px; font-size:13px; font-weight:600; color:${i.on <= i.rop ? '#ef4444' : 'var(--text-main)'}">${i.on} <span style="font-size:11px; color:var(--text-muted); font-weight:400;">/ ${i.rop}</span></td>
              <td style="padding:16px 24px; font-size:13px; color:${daysAgo(i.lastSale) > 90 ? '#ef4444' : 'var(--text-muted)'};">
                 ${i.lastSale ? new Date(i.lastSale).toLocaleDateString() : 'Never'}
              </td>
              <td style="padding:16px 24px; font-size:13px; font-weight:600; color:var(--text-main);">${money(Number(i.on) * Number(i.cost))}</td>
              <td style="padding:16px 24px; text-align:right;"><button class="btn btn-secondary" style="height:32px; padding:0 12px; font-size:12px; font-weight:600;">Edit</button></td>
           </tr>
        `).join("");
    }

    function getStatusStyle(s) {
      if (s === 'Confirmed' || s === 'Received') return 'badge-green';
      if (s === 'Delayed') return 'badge-red';
      if (s === 'Awaiting approval') return 'badge-yellow';
      return 'badge-gray';
    }

    // Initial Render
    renderPOs();
    renderKpis();
  </script>
</body>

</html>
