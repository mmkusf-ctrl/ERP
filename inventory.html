<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Inventory | Stark Premium ERP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    /* Card Hover & Icon Effects */
    /* KPI Horizontal Fix */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      /* Tighter gap */
    }

    @media (max-width: 768px) {
      .kpi-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .card-compact {
      padding: 16px !important;
      /* Smaller padding */
    }

    .card-compact .stat-value {
      font-size: 28px;
      /* Smaller font */
      margin-bottom: 4px;
    }

    .card-compact .card-header {
      margin-bottom: 12px;
    }

    /* Action Card Adjustment */
    .action-card {
      text-align: left;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 180px;
      /* Reduced height from 220px */
      padding: 20px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid var(--border);
    }

    .action-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
      border-color: var(--primary-light);
    }

    .action-card:hover .action-icon {
      transform: scale(1.15) rotate(8deg);
      opacity: 0.15;
    }

    .action-icon {
      position: absolute;
      bottom: -20px;
      right: -20px;
      font-size: 120px;
      /* Slightly smaller icon */
      opacity: 0.08;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      line-height: 1;
      color: var(--text-main);
      pointer-events: none;
    }

    /* Button Placement in Cards */
    .card-actions {
      margin-top: auto;
      padding-top: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* KPI Clickable Styles */
    .clickable-kpi {
      cursor: pointer;
      transition: transform 0.2s, border-color 0.2s;
    }

    .clickable-kpi:hover {
      transform: translateY(-2px);
      border-color: var(--primary);
    }

    .clickable-kpi.active {
      border-color: var(--primary);
      background: var(--bg-surface);
      box-shadow: 0 0 0 2px var(--primary-fade);
    }
  </style>
</head>

<body>
  <!-- Top Navigation -->
  <header class="topbar">
    <div class="topbar-inner">
      <a href="dashboard.html" class="logo">
        <img src="images/stark-logo.png" alt="Stark Premium">
        <span class="logo-text">Stark ERP</span>
      </a>

      <nav class="nav">
        <a class="nav-link" href="dashboard.html">Overview</a>
        <a class="nav-link" href="crm.html">CRM</a>
        <a class="nav-link" href="vendor.html">Vendor</a>
        <a class="nav-link" href="purchasing.html">Purchasing</a>
        <a class="nav-link active" href="inventory.html">Inventory</a>
        <a class="nav-link" href="accounting.html">Accounting</a>
        <a class="nav-link" href="orders.html">Orders</a>
        <a class="nav-link" href="logistics.html">Logistics</a>
        <a class="nav-link" href="trends.html">Trends</a>
      </nav>

      <div style="display:flex; align-items:center; gap:12px;">
        <div class="badge badge-green" style="display:none; @media(min-width:700px){display:inline-flex;}">
          Online
        </div>
        <button class="hamburger" onclick="openMobileNav()">
          <span></span><span></span><span></span>
        </button>
      </div>
    </div>
  </header>

  <!-- Mobile Drawer -->
  <div class="mobile-nav" id="mobileNav">
    <div class="mobile-drawer">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
        <strong style="font-size:16px;">Navigation</strong>
        <button onclick="closeMobileNav()"
          style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
      </div>
      <a class="mobile-link" href="dashboard.html">Overview</a>
      <a class="mobile-link" href="crm.html">CRM</a>
      <a class="mobile-link" href="vendor.html">Vendor</a>
      <a class="mobile-link" href="purchasing.html">Purchasing</a>
      <a class="mobile-link active" href="inventory.html">Inventory</a>
      <a class="mobile-link" href="accounting.html">Accounting</a>
      <a class="mobile-link" href="orders.html">Orders</a>
      <a class="mobile-link" href="logistics.html">Logistics</a>
      <a class="mobile-link" href="trends.html">Trends</a>
    </div>
  </div>

  <main class="container">
    <!-- Header -->
    <div class="page-header">
      <h1 class="page-title">Inventory Operations</h1>
      <p class="page-desc">Manage stock levels, process inbound shipments, and maintain accuracy.</p>
      <div class="gold-line"></div>
    </div>

    <!-- KPIs (Restored & Interactive) -->
    <section class="kpi-grid" style="margin-bottom:32px;">
      <article class="card-kpi clickable-kpi" onclick="setFilter('all')" id="kpiAll">
        <div class="card-header">
          <div class="card-title">Total SKUs</div>
          <div class="badge badge-green">Catalog</div>
        </div>
        <div class="stat-value" id="kTotal">â€”</div>
        <div class="stat-trend neutral">View All</div>
      </article>

      <article class="card-kpi clickable-kpi" onclick="setFilter('low')" id="kpiLow">
        <div class="card-header">
          <div class="card-title">Low Stock</div>
          <div class="badge badge-yellow">Alert</div>
        </div>
        <div class="stat-value" id="kLow">0</div>
        <div class="stat-trend neutral">Reorder Soon</div>
      </article>

      <article class="card-kpi clickable-kpi" onclick="setFilter('oos')" id="kpiOOS">
        <div class="card-header">
          <div class="card-title">Out of Stock</div>
          <div class="badge badge-red">Critical</div>
        </div>
        <div class="stat-value" id="kOOS">0</div>
        <div class="stat-trend down">Restock Now</div>
      </article>

      <article class="card-kpi">
        <div class="card-header">
          <div class="card-title">Valuation</div>
          <div class="badge badge-green">Asset</div>
        </div>
        <div class="stat-value" id="kValue">$0.00</div>
        <div class="stat-trend up">Total Cost Basis</div>
      </article>
    </section>

    <!-- Operations Grid -->
    <section class="kpi-grid" style="margin-bottom:40px;">

      <!-- Receive Inventory -->
      <article class="card action-card" onclick="openReceiveModal()"
        style="background: linear-gradient(to bottom right, #ffffff, #f8fafc);">
        <div>
          <div class="card-title" style="color:var(--primary);">Inbound</div>
          <h3 style="font-size:20px; font-weight:800; margin:8px 0; color:var(--text-main);">Receive Inventory</h3>
          <p style="font-size:13px; color:var(--text-muted); line-height:1.5;">Process specific items or full POs
            arrival.</p>
        </div>
        <div class="card-actions">
          <span class="btn btn-primary" style="width:100%; height:42px; justify-content:space-between; padding:0 20px;">
            Start Reception <span>&rarr;</span>
          </span>
        </div>
        <div class="action-icon">ðŸ“¦</div>
      </article>

      <!-- Adjust Inventory -->
      <article class="card action-card" onclick="openAdjustModal()"
        style="background: linear-gradient(to bottom right, #ffffff, #f8fafc);">
        <div>
          <div class="card-title" style="color:var(--warning);">Corrections</div>
          <h3 style="font-size:20px; font-weight:800; margin:8px 0; color:var(--text-main);">Adjust Stock</h3>
          <p style="font-size:13px; color:var(--text-muted); line-height:1.5;">Manual adjustments for damage, loss, or
            extras.</p>
        </div>
        <div class="card-actions">
          <span class="btn btn-secondary"
            style="width:100%; height:42px; justify-content:space-between; padding:0 20px;">
            Adjust <span>&rarr;</span>
          </span>
        </div>
        <div class="action-icon">ðŸ”§</div>
      </article>

      <!-- Cycle Count -->
      <article class="card action-card" onclick="openCountModal()"
        style="background: linear-gradient(to bottom right, #ffffff, #f8fafc);">
        <div>
          <div class="card-title" style="color:var(--success);">Audit</div>
          <h3 style="font-size:20px; font-weight:800; margin:8px 0; color:var(--text-main);">Cycle Count</h3>
          <p style="font-size:13px; color:var(--text-muted); line-height:1.5;">Verify physical stock accuracy by zone.
          </p>
        </div>
        <div class="card-actions">
          <span class="btn btn-secondary"
            style="width:100%; height:42px; justify-content:space-between; padding:0 20px;">
            Start Count <span>&rarr;</span>
          </span>
        </div>
        <div class="action-icon">âœ…</div>
      </article>

      <!-- Add Item Quick Link -->
      <article class="card action-card" onclick="openItemModal()"
        style="background:var(--bg-body); border:2px dashed var(--border);">
        <div style="display:flex; flex-direction:column; justify-content:center; height:100%;">
          <div class="card-title" style="margin-bottom:8px;">Catalog</div>
          <h3 style="font-size:20px; font-weight:700; color:var(--text-muted); margin:0;">+ New Item</h3>
          <p style="font-size:13px; color:var(--text-muted); margin-top:8px;">Register a new SKU.</p>
        </div>
      </article>

    </section>

    <!-- Context Grid -->
    <div class="grid grid-2">

      <!-- Upcoming Deliveries -->
      <section class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
          <h2 style="font-size:18px; margin:0;">Upcoming Deliveries</h2>
          <span class="badge badge-green">Based on PO ETA</span>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>ETA</th>
                <th>PO #</th>
                <th>Vendor</th>
                <th>Items</th>
                <th>Status</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="delBody"></tbody>
          </table>
        </div>
      </section>

      <!-- Current Stock (Mini View) -->
      <aside class="card" id="stockCard">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
          <h2 style="font-size:18px; margin:0;" id="stockTitle">Quick Stock View</h2>
          <span class="badge" id="stockBadge"
            style="display:none; background:var(--primary); color:white;">Filtered</span>
        </div>
        <input id="q" class="input" placeholder="Search SKU..." oninput="renderStock()" style="margin-bottom:16px;" />
        <div style="max-height:400px; overflow-y:auto;" id="stockList">
          <!-- Filled by JS -->
        </div>
      </aside>

    </div>

    <div style="margin-top:40px; text-align:center; color:var(--text-muted); font-size:13px;">
      &copy; 2026 Stark Premium ERP. secure. fast. reliable.
    </div>

  </main>

  <!-- Modals (Same as before) -->
  <div class="mobile-nav" id="receiveModal" style="z-index:900;">
    <div class="card"
      style="position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); width:min(90%, 500px); box-shadow:var(--shadow-card);">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h3 style="margin:0;">Receive Inventory</h3>
        <button onclick="closeReceiveModal()"
          style="border:none; background:transparent; font-size:24px; cursor:pointer;">&times;</button>
      </div>
      <div style="display:grid; gap:16px;">
        <select id="rPo" class="input">
          <option value="">Select Purchase Order...</option>
        </select>
        <div
          style="text-align:center; padding:10px; background:#f8fafc; border-radius:8px; color:var(--text-muted); font-size:13px;">
          OR
        </div>
        <select id="rMetaItem" class="input"> <!-- Filled by items -->
        </select>
        <input id="rQty" type="number" class="input" placeholder="Quantity Received" />

        <button class="btn btn-primary" onclick="doReceive()">Process Receipt</button>
      </div>
    </div>
  </div>

  <div class="mobile-nav" id="adjustModal" style="z-index:900;">
    <div class="card"
      style="position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); width:min(90%, 500px); box-shadow:var(--shadow-card);">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h3 style="margin:0;">Adjust Stock</h3>
        <button onclick="closeAdjustModal()"
          style="border:none; background:transparent; font-size:24px; cursor:pointer;">&times;</button>
      </div>
      <div style="display:grid; gap:16px;">
        <select id="aItem" class="input"></select>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
          <input id="aQty" type="number" class="input" placeholder="Qty Change (+/-)" />
          <select id="aReason" class="input">
            <option>Damaged</option>
            <option>Lost/Stolen</option>
            <option>Found</option>
            <option>Correction</option>
          </select>
        </div>
        <button class="btn btn-warning" style="background:var(--warning); color:white; border:none;"
          onclick="doAdjust()">Apply Adjustment</button>
      </div>
    </div>
  </div>

  <div class="mobile-nav" id="countModal" style="z-index:900;">
    <div class="card"
      style="position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); width:min(90%, 500px); max-height:80vh; overflow-y:auto; box-shadow:var(--shadow-card);">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h3 style="margin:0;">Cycle Count Session</h3>
        <button onclick="closeCountModal()"
          style="border:none; background:transparent; font-size:24px; cursor:pointer;">&times;</button>
      </div>
      <p style="font-size:13px; color:var(--text-muted);">Please verify physical counts for the following randomly
        selected items:</p>
      <div id="countList" style="display:grid; gap:12px; margin-bottom:16px;"></div>
      <button class="btn btn-primary" onclick="doCycleCount()">Submit Counts</button>
    </div>
  </div>

  <div class="mobile-nav" id="itemModal" style="z-index:900;">
    <div class="card"
      style="position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); width:min(90%, 600px); max-height:90vh; overflow-y:auto; box-shadow:var(--shadow-card);">
      <div
        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding-bottom:12px; border-bottom:1px solid var(--border);">
        <h3 style="margin:0;">Add Inventory Item</h3>
        <button onclick="closeItemModal()"
          style="border:none; bg:transparent; font-size:24px; cursor:pointer;">&times;</button>
      </div>
      <div style="display:grid; gap:16px;">
        <div style="display:grid; grid-template-columns:1fr 2fr; gap:16px;">
          <input id="iSku" class="input" placeholder="SKU (e.g. A-101)" />
          <input id="iName" class="input" placeholder="Item Name" />
        </div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
          <input id="iCat" class="input" placeholder="Category" />
          <input id="iWh" class="input" placeholder="Warehouse" />
        </div>
        <input id="iSup" class="input" placeholder="Supplier" />
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:16px;">
          <div>
            <label style="font-size:11px; font-weight:700; color:var(--text-muted); text-transform:uppercase;">On
              Hand</label>
            <input id="iOn" class="input" type="number" />
          </div>
          <div>
            <label style="font-size:11px; font-weight:700; color:var(--text-muted); text-transform:uppercase;">Reorder
              Pt</label>
            <input id="iRop" class="input" type="number" />
          </div>
          <div>
            <label style="font-size:11px; font-weight:700; color:var(--text-muted); text-transform:uppercase;">Unit
              Cost</label>
            <input id="iCost" class="input" type="number" step="0.01" />
          </div>
        </div>
        <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:16px;">
          <button class="btn btn-secondary" onclick="closeItemModal()">Cancel</button>
          <button class="btn btn-primary" onclick="addItem()">Save Item</button>
        </div>
      </div>
    </div>
  </div>

  <div id="toastWrap" style="position:fixed; bottom:20px; right:20px; z-index:9999; display:grid; gap:10px;"></div>

  <script src="erp.js"></script>
  <script>
    const AUTH_KEY = "stark_erp_auth_v1";
    (function () { try { const a = JSON.parse(localStorage.getItem(AUTH_KEY) || "null"); if (!a || !a.user) window.location.href = "index.html"; } catch { window.location.href = "index.html"; } })();

    const KEY_CUST = "stark_erp_customers_v1";
    (function () { try { const a = JSON.parse(localStorage.getItem(AUTH_KEY) || "null"); if (!a || !a.user) window.location.href = "index.html"; } catch { window.location.href = "index.html"; } })();

    const ITEM_KEY = "stark_erp_items_v2";
    const PO_KEY = "stark_erp_pos_v1";
    let CURRENT_FILTER = "all"; // all, low, oos

    function load(key, fallback) {
      try { return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }
      catch { return fallback; }
    }
    function save(key, data) { localStorage.setItem(key, JSON.stringify(data)); }
    function money(n) { return Number(n || 0).toLocaleString(undefined, { style: "currency", currency: "USD" }); }

    // --- Modal Logic ---
    function openReceiveModal() { populateSelects(); document.getElementById("receiveModal").classList.add("open"); }
    function closeReceiveModal() { document.getElementById("receiveModal").classList.remove("open"); }
    function openAdjustModal() { populateSelects(); document.getElementById("adjustModal").classList.add("open"); }
    function closeAdjustModal() { document.getElementById("adjustModal").classList.remove("open"); }
    function openCountModal() { generateCountList(); document.getElementById("countModal").classList.add("open"); }
    function closeCountModal() { document.getElementById("countModal").classList.remove("open"); }
    function openItemModal() { document.getElementById("itemModal").classList.add("open"); }
    function closeItemModal() { document.getElementById("itemModal").classList.remove("open"); }

    // --- Core Logic ---
    function populateSelects() {
      const items = load(ITEM_KEY, []);
      const pos = load(PO_KEY, []);
      const itemOpts = `<option value="">Select Item...</option>` + items.map(i => `<option value="${i.sku}">${i.sku} - ${i.name} (Cur: ${i.on})</option>`).join("");
      document.getElementById("aItem").innerHTML = itemOpts;
      document.getElementById("rMetaItem").innerHTML = itemOpts;
      const poOpts = `<option value="">Select Purchase Order...</option>` + pos.filter(p => p.status !== "Completed").map(p => `<option value="${p.id}">${p.id} - ${p.vendor} (ETA: ${p.eta})</option>`).join("");
      document.getElementById("rPo").innerHTML = poOpts;
    }

    function doReceive() {
      const poId = document.getElementById("rPo").value;
      const sku = document.getElementById("rMetaItem").value;
      const qty = Number(document.getElementById("rQty").value);
      if (!qty || qty <= 0) return toast("Error", "Valid quantity required.");
      const list = load(ITEM_KEY, []);
      if (poId) {
        const pos = load(PO_KEY, []);
        const p = pos.find(x => x.id === poId);
        if (p) {
          p.status = "Completed"; save(PO_KEY, pos);
          if (list.length) { list[0].on += qty; save(ITEM_KEY, list); }
          toast("Success", `Received against ${poId}.`);
        }
      } else if (sku) {
        const item = list.find(x => x.sku === sku);
        if (item) { item.on += qty; save(ITEM_KEY, list); toast("Success", `Received ${sku}.`); }
      }
      closeReceiveModal(); renderAll();
    }

    function doAdjust() {
      const sku = document.getElementById("aItem").value;
      const qty = Number(document.getElementById("aQty").value);
      const reason = document.getElementById("aReason").value;
      if (!sku || !qty) return toast("Error", "Required fields missing.");
      const list = load(ITEM_KEY, []);
      const item = list.find(x => x.sku === sku);
      if (item) {
        item.on += qty; save(ITEM_KEY, list);
        toast("Success", "Stock adjusted.");
        closeAdjustModal(); renderAll();
      }
    }

    function generateCountList() {
      const items = load(ITEM_KEY, []);
      if (!items.length) return document.getElementById("countList").innerHTML = "No items.";
      const subset = items.sort(() => 0.5 - Math.random()).slice(0, 3);
      const html = subset.map(i => `
            <div style="background:#f8fafc; padding:12px; border-radius:8px; border:1px solid var(--border);">
                 <div style="font-weight:600; font-size:13px;">${i.sku} - ${i.name}</div>
                 <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px;">
                     <span style="font-size:12px; color:var(--text-muted);">System: ${i.on}</span>
                     <input class="input" style="width:100px; height:32px;" placeholder="Actual" type="number" />
                 </div>
            </div>`).join("");
      document.getElementById("countList").innerHTML = html;
    }

    function doCycleCount() { toast("Success", "Counts submitted."); closeCountModal(); }

    function addItem() {
      const sku = (document.getElementById("iSku").value || "").trim();
      const name = (document.getElementById("iName").value || "").trim();
      if (!sku || !name) return toast("Error", "SKU/Name required.");
      const item = {
        sku, name,
        cat: (document.getElementById("iCat").value || "").trim() || "General",
        wh: (document.getElementById("iWh").value || "").trim() || "WH-A",
        sup: (document.getElementById("iSup").value || "").trim() || "Vendor",
        on: Number(document.getElementById("iOn").value || 0),
        rop: Number(document.getElementById("iRop").value || 0),
        cost: Number(document.getElementById("iCost").value || 0)
      };
      const list = load(ITEM_KEY, []);
      list.unshift(item); save(ITEM_KEY, list);
      closeItemModal(); toast("Success", "Item added."); renderAll();
    }

    // --- Views ---
    function setFilter(type) {
      CURRENT_FILTER = type;
      // visual state
      document.querySelectorAll(".clickable-kpi").forEach(el => el.classList.remove("active"));
      if (type !== 'all') {
        const el = document.getElementById("kpi" + type.charAt(0).toUpperCase() + type.slice(1));
        if (el) el.classList.add("active");
        document.getElementById("stockBadge").style.display = "inline-flex";
        document.getElementById("stockBadge").textContent = (type === 'low' ? 'Low Stock' : 'Out of Stock');
      } else {
        document.getElementById("stockBadge").style.display = "none";
      }
      renderStock();
    }

    function renderStock() {
      const q = (document.getElementById("q").value || "").toLowerCase();
      const items = load(ITEM_KEY, []);

      // Update KPIs
      const low = items.filter(i => i.on <= i.rop && i.on > 0).length;
      const oos = items.filter(i => i.on <= 0).length;
      const val = items.reduce((acc, i) => acc + (i.on * i.cost), 0);
      document.getElementById("kTotal").textContent = items.length;
      document.getElementById("kLow").textContent = low;
      document.getElementById("kOOS").textContent = oos;
      document.getElementById("kValue").textContent = money(val);

      // Filter Logic
      const filtered = items.filter(i => {
        if (q && !(i.sku + i.name).toLowerCase().includes(q)) return false;
        if (CURRENT_FILTER === 'low' && (i.on > i.rop || i.on <= 0)) return false;
        if (CURRENT_FILTER === 'oos' && i.on > 0) return false;
        return true;
      });

      const html = filtered.map(i => `
            <div style="padding:12px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div style="font-weight:600; font-size:13px;">${i.sku}</div>
                    <div style="font-size:12px; color:var(--text-muted);">${i.name}</div>
                </div>
                <div style="text-align:right;">
                    <div style="font-weight:700; color:${i.on <= 0 ? 'var(--danger)' : (i.on <= i.rop ? 'var(--warning)' : 'var(--text-main)')};">${i.on}</div>
                    <div style="font-size:11px; color:var(--text-muted);">${i.wh}</div>
                </div>
            </div>
        `).join("");

      document.getElementById("stockList").innerHTML = html || `<div style="padding:20px; text-align:center; color:var(--text-muted); font-size:13px;">No items match filter.</div>`;
    }

    function renderDeliveries() {
      const pos = load(PO_KEY, []);
      const active = pos.filter(p => p.status !== "Completed" && p.status !== "Delivered");
      active.sort((a, b) => new Date(a.eta) - new Date(b.eta));
      const tbody = document.getElementById("delBody");
      tbody.innerHTML = "";
      if (!active.length) return tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; color:var(--text-muted);">No upcoming deliveries.</td></tr>`;

      active.forEach(p => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
                <td>${p.eta || "â€”"}</td>
                <td><strong>${p.id}</strong></td>
                <td>${p.vendor}</td>
                <td>${(p.lines || "").split("\n").filter(Boolean).length} lines</td>
                <td><span class="badge badge-yellow">${p.status}</span></td>
                <td><button class="btn btn-secondary" style="height:32px; padding:0 12px; font-size:12px;" onclick="document.getElementById('receiveModal').classList.add('open')">Receive</button></td>
             `;
        tbody.appendChild(tr);
      });
    }

    function renderAll() {
      renderStock();
      renderDeliveries();
    }

    // Auto-seed
    if (load(ITEM_KEY, []).length === 0) {
      const demo = [
        { sku: "BX-9001", name: "Premium Gift Box", cat: "Packaging", wh: "WH-A", sup: "PackPro", on: 140, rop: 50, cost: 1.60 },
        { sku: "NK-1001", name: "Necklace â€” Aurora", cat: "Finished Goods", wh: "WH-B", sup: "Stark Mfg", on: 62, rop: 30, cost: 42.00 },
        { sku: "RG-2001", name: "Ring â€” Obsidian", cat: "Finished Goods", wh: "WH-B", sup: "Stark Mfg", on: 0, rop: 18, cost: 38.00 }
      ];
      save(ITEM_KEY, demo);
    }

    renderAll();
  </script>
</body>

</html>
