<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Vendor | Stark Premium ERP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Top Navigation -->
    <header class="topbar">
        <div class="topbar-inner">
            <a href="dashboard.html" class="logo">
                <img src="images/stark-logo.png" alt="Stark Premium">
                <span class="logo-text">Stark ERP</span>
            </a>

            <nav class="nav">
                <a class="nav-link" href="dashboard.html">Overview</a>
                <a class="nav-link" href="crm.html">CRM</a>
                <a class="nav-link active" href="vendor.html">Vendor</a>
                <a class="nav-link" href="purchasing.html">Purchasing</a>
                <a class="nav-link" href="inventory.html">Inventory</a>
                <a class="nav-link" href="accounting.html">Accounting</a>
                <a class="nav-link" href="orders.html">Orders</a>
                <a class="nav-link" href="logistics.html">Logistics</a>
                <a class="nav-link" href="trends.html">Trends</a>
            </nav>

            <div style="display:flex; align-items:center; gap:12px;">
                <button class="btn btn-primary" onclick="openVendorModal()">
                    + Add Vendor
                </button>
                <button class="hamburger" onclick="openMobileNav()">
                    <span></span><span></span><span></span>
                </button>
            </div>
        </div>
    </header>

    <div class="mobile-nav" id="mobileNav">
        <div class="mobile-drawer">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                <strong style="font-size:16px;">Navigation</strong>
                <button onclick="closeMobileNav()"
                    style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
            </div>
            <a class="mobile-link" href="dashboard.html">Overview</a>
            <a class="mobile-link" href="crm.html">CRM</a>
            <a class="mobile-link active" href="vendor.html">Vendor</a>
            <a class="mobile-link" href="purchasing.html">Purchasing</a>
            <a class="mobile-link" href="inventory.html">Inventory</a>
            <a class="mobile-link" href="orders.html">Orders</a>
            <a class="mobile-link" href="logistics.html">Logistics</a>
            <a class="mobile-link" href="trends.html">Trends</a>
        </div>
    </div>

    <main class="container">

        <!-- Header -->
        <div class="page-header">
            <h1 class="page-title">Vendor Management</h1>
            <p class="page-desc">Track supplier performance, diverse procurement sources, and contract status.</p>
            <div class="gold-line"></div>
        </div>

        <!-- Stats -->
        <section class="grid grid-4" style="margin-bottom:32px;">
            <article class="card card-premium clickable-kpi active" onclick="setFilter('all')" id="kpiAll">
                <div class="card-header">
                    <div class="card-title">Total Vendors</div>
                    <div class="badge badge-green">Network</div>
                </div>
                <div class="stat-value" id="kVendors">0</div>
                <div class="stat-trend neutral">Global Supply</div>
            </article>

            <article class="card card-premium clickable-kpi" onclick="setFilter('top')" id="kpiTop">
                <div class="card-header">
                    <div class="card-title">Top Rated</div>
                    <div class="badge badge-green">Elite</div>
                </div>
                <div class="stat-value" id="kTop">0</div>
                <div class="stat-trend up">Performance > 90%</div>
            </article>

            <article class="card card-premium clickable-kpi" onclick="setFilter('risk')" id="kpiRisk">
                <div class="card-header">
                    <div class="card-title">At Risk</div>
                    <div class="badge badge-red">Attention</div>
                </div>
                <div class="stat-value" id="kRisk">0</div>
                <div class="stat-trend down">Rating < 70%</div>
            </article>

            <article class="card card-premium clickable-kpi" onclick="window.location.href='purchasing.html'">
                <div class="card-header">
                    <div class="card-title">Active Spend</div>
                    <div class="badge badge-yellow">YTD</div>
                </div>
                <div class="stat-value" id="kSpend">$0.00</div>
                <div class="stat-trend neutral">All Contracts</div>
            </article>
        </section>

        <!-- Main Content -->
        <div class="grid grid-2">
            <!-- Directory -->
            <section class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h2 style="font-size:18px; margin:0;" id="dirTitle">Vendor Directory</h2>
                    <span class="badge" id="listBadge"
                        style="display:none; background:var(--primary); color:white;">Filtered</span>
                </div>

                <input id="search" class="input" placeholder="Search vendors..." oninput="render()"
                    style="margin-bottom:16px;" />

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Vendor</th>
                                <th>Category</th>
                                <th>Rating</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="vBody"></tbody>
                    </table>
                </div>
            </section>

            <!-- Details -->
            <aside style="display:grid; gap:24px; align-content:start;">
                <div class="card">
                    <h2 style="font-size:16px; margin:0 0 16px;">Vendor Profile</h2>

                    <div id="detailPlaceholder"
                        style="padding:40px 0; text-align:center; color:var(--text-muted); font-size:13px;">
                        Select a vendor to view details.
                    </div>

                    <div id="detailContent" style="display:none;">
                        <div
                            style="background:var(--bg-body); padding:20px; border-radius:var(--radius-md); border:1px solid var(--border); margin-bottom:16px;">
                            <strong style="display:block; font-size:18px; margin-bottom:4px;" id="dName">Name</strong>
                            <div style="font-size:13px; color:var(--text-muted); margin-bottom:12px;" id="dCat">Category
                            </div>

                            <div style="display:grid; gap:8px; font-size:13px;">
                                <div style="display:flex; gap:8px;">
                                    <span style="color:var(--text-muted); width:20px;">üìç</span> <span
                                        id="dLoc">Location</span>
                                </div>
                                <div style="display:flex; gap:8px;">
                                    <span style="color:var(--text-muted); width:20px;">üë§</span> <span
                                        id="dContact">Contact</span>
                                </div>
                                <div style="display:flex; gap:8px;">
                                    <span style="color:var(--text-muted); width:20px;">üìß</span> <span
                                        id="dEmail">Email</span>
                                </div>
                            </div>
                        </div>

                        <div
                            style="background:#f8fafc; padding:16px; border-radius:var(--radius-md); border:1px solid var(--border); margin-bottom:12px;">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                                <span style="font-size:13px; font-weight:600;">Performance Score</span>
                                <span class="badge" id="dScoreBadge">0%</span>
                            </div>
                            <div style="height:6px; background:#e2e8f0; border-radius:3px; overflow:hidden;">
                                <div id="dScoreBar"
                                    style="height:100%; width:0%; background:var(--primary); transition:width 0.5s;">
                                </div>
                            </div>
                        </div>

                        <div
                            style="background:#f8fafc; padding:16px; border-radius:var(--radius-md); border:1px solid var(--border);">
                            <strong style="display:block; font-size:13px; margin-bottom:6px;">Payment Terms</strong>
                            <div id="dTerms" style="font-size:13px; color:var(--text-muted);">Net 30</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header"><span class="card-title">Setup</span></div>
                    <button class="btn btn-secondary" style="width:100%;" onclick="seedVendors()">Generate Demo
                        Vendors</button>
                </div>
            </aside>
        </div>

        <div style="margin-top:40px; text-align:center; color:var(--text-muted); font-size:13px;">
            &copy; 2026 Stark Premium ERP.
        </div>
    </main>

    <!-- Add Vendor Modal -->
    <div class="mobile-nav" id="vendorModal" style="z-index:900;">
        <div class="card"
            style="position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); width:min(90%, 500px); max-height:90vh; overflow-y:auto; box-shadow:var(--shadow-card);">
            <div
                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding-bottom:12px; border-bottom:1px solid var(--border);">
                <h3 style="margin:0;">Add Vendor</h3>
                <button onclick="closeVendorModal()"
                    style="border:none; bg:transparent; font-size:24px; cursor:pointer;">&times;</button>
            </div>

            <div style="display:grid; gap:16px;">
                <input id="vName" class="input" placeholder="Vendor Name" />

                <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                    <input id="vCat" class="input" placeholder="Category (e.g. Raw Materials)" />
                    <input id="vLoc" class="input" placeholder="Location" />
                </div>

                <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                    <input id="vContact" class="input" placeholder="Contact Person" />
                    <input id="vEmail" class="input" placeholder="Email" />
                </div>

                <select id="vTerms" class="input">
                    <option value="Net 30">Net 30</option>
                    <option value="Net 60">Net 60</option>
                    <option value="Immediate">Immediate</option>
                </select>

                <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:8px;">
                    <button class="btn btn-secondary" onclick="closeVendorModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="addVendor()">Onboard Vendor</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toastWrap" style="position:fixed; bottom:20px; right:20px; z-index:9999; display:grid; gap:10px;"></div>

    <script src="erp.js"></script>
    <script>
        const AUTH_KEY = "stark_erp_auth_v1";
        (function () { try { const a = JSON.parse(localStorage.getItem(AUTH_KEY) || "null"); if (!a || !a.user) window.location.href = "index.html"; } catch { window.location.href = "index.html"; } })();

        const KEY_VEND = "stark_erp_vendors_v1";
        let CURRENT_FILTER = "all"; // all, top, risk

        function load(key, fb) { try { return JSON.parse(localStorage.getItem(key) || JSON.stringify(fb)); } catch { return fb; } }
        function save(key, d) { localStorage.setItem(key, JSON.stringify(d)); }
        function money(n) { return Number(n || 0).toLocaleString(undefined, { style: "currency", currency: "USD" }); }

        function openVendorModal() { document.getElementById("vendorModal").classList.add("open"); }
        function closeVendorModal() { document.getElementById("vendorModal").classList.remove("open"); }

        function addVendor() {
            const name = document.getElementById("vName").value.trim();
            if (!name) return toast("Error", "Name required.");

            const v = {
                id: "V-" + Date.now(),
                name,
                cat: document.getElementById("vCat").value || "General",
                loc: document.getElementById("vLoc").value || "Unknown",
                contact: document.getElementById("vContact").value,
                email: document.getElementById("vEmail").value,
                terms: document.getElementById("vTerms").value,
                rating: 100, // Start perfect
                spend: 0,
                status: "Active"
            };

            const list = load(KEY_VEND, []);
            list.push(v);
            save(KEY_VEND, list);
            closeVendorModal();
            toast("Success", "Vendor onboarded.");
            render();
        }

        function setFilter(f) {
            CURRENT_FILTER = f;
            document.querySelectorAll(".clickable-kpi").forEach(x => x.classList.remove("active"));
            if (f === 'all') document.getElementById("kpiAll").classList.add("active");
            if (f === 'top') document.getElementById("kpiTop").classList.add("active");
            if (f === 'risk') document.getElementById("kpiRisk").classList.add("active");
            render();
        }

        function render() {
            const list = load(KEY_VEND, []);
            const search = document.getElementById("search").value.toLowerCase();

            // Calcs
            const top = list.filter(v => v.rating >= 90).length;
            const risk = list.filter(v => v.rating < 70).length;
            const spend = list.reduce((a, b) => a + (b.spend || 0), 0);

            document.getElementById("kVendors").textContent = list.length;
            document.getElementById("kTop").textContent = top;
            document.getElementById("kRisk").textContent = risk;
            document.getElementById("kSpend").textContent = money(spend);

            // Filter
            const shown = list.filter(v => {
                if (search && !v.name.toLowerCase().includes(search)) return false;
                if (CURRENT_FILTER === 'top' && v.rating < 90) return false;
                if (CURRENT_FILTER === 'risk' && v.rating >= 70) return false;
                return true;
            });

            const tbody = document.getElementById("vBody");
            tbody.innerHTML = "";

            // Update visual title
            const mapTitle = { 'all': "Vendor Directory", 'top': "Top Performing Vendors", 'risk': "At-Risk Vendors" };
            document.getElementById("dirTitle").textContent = mapTitle[CURRENT_FILTER];

            if (!shown.length) return tbody.innerHTML = `<tr><td colspan="4" style="text-align:center; padding:20px; color:var(--text-muted);">No vendors found.</td></tr>`;

            shown.forEach(v => {
                let badge = "badge-green";
                if (v.rating < 90) badge = "badge-yellow";
                if (v.rating < 70) badge = "badge-red";

                const tr = document.createElement("tr");
                tr.style.cursor = "pointer";
                tr.onclick = () => showDetail(v);
                tr.innerHTML = `
                <td>
                    <div style="font-weight:600; color:var(--text-main);">${v.name}</div>
                    <div style="font-size:12px; color:var(--text-muted);">${v.contact || ""}</div>
                </td>
                <td>${v.cat}</td>
                <td>
                    <div style="display:flex; align-items:center; gap:6px;">
                        <div style="width:30px; height:4px; background:#e2e8f0; border-radius:2px;"><div style="width:${v.rating}%; background:${v.rating >= 90 ? 'var(--success)' : (v.rating < 70 ? 'var(--danger)' : 'var(--warning)')}; height:100%; border-radius:2px;"></div></div>
                        <span style="font-size:11px; font-weight:600;">${v.rating}%</span>
                    </div>
                </td>
                <td><span class="badge ${v.rating < 70 ? 'badge-red' : 'badge-green'}">${v.rating < 70 ? 'Review' : 'Active'}</span></td>
            `;
                tbody.appendChild(tr);
            });
        }

        function showDetail(v) {
            document.getElementById("detailPlaceholder").style.display = "none";
            document.getElementById("detailContent").style.display = "block";

            document.getElementById("dName").textContent = v.name;
            document.getElementById("dCat").textContent = v.cat;
            document.getElementById("dLoc").textContent = v.loc;
            document.getElementById("dContact").textContent = v.contact || "‚Äî";
            document.getElementById("dEmail").textContent = v.email || "‚Äî";
            document.getElementById("dTerms").textContent = v.terms || "Standard";

            document.getElementById("dScoreBadge").textContent = v.rating + "%";
            document.getElementById("dScoreBar").style.width = v.rating + "%";

            let color = "var(--success)";
            if (v.rating < 90) color = "var(--warning)";
            if (v.rating < 70) color = "var(--danger)";
            document.getElementById("dScoreBar").style.background = color;
            document.getElementById("dScoreBadge").style.background = color.replace(")", ", 0.12)").replace("rgb", "rgba");
            document.getElementById("dScoreBadge").style.color = color;
        }

        function seedVendors() {
            const demo = [
                { id: "V1", name: "PackPro Industries", cat: "Packaging", loc: "Dallas, TX", contact: "Mike R", email: "mike@packpro.com", terms: "Net 60", rating: 95, spend: 12000 },
                { id: "V2", name: "Stark Manufacturing", cat: "Raw Materials", loc: "Germany", contact: "Hans G", email: "hans@starkmfg.de", terms: "Net 30", rating: 88, spend: 45000 },
                { id: "V3", name: "Global Logistics", cat: "Logistics", loc: "Singapore", contact: "Wei L", email: "wei@global.sg", terms: "Immediate", rating: 65, spend: 8200 },
                { id: "V4", name: "Apex Steel", cat: "Raw Materials", loc: "Cleveland, OH", contact: "Sarah J", email: "sarah@apex.com", terms: "Net 45", rating: 92, spend: 21000 },
                { id: "V5", name: "TechParts Inc", cat: "Electronics", loc: "San Jose, CA", contact: "Dave K", email: "dave@techparts.com", terms: "Net 30", rating: 78, spend: 5600 }
            ];
            save(KEY_VEND, demo);
            toast("Data Loaded", "Demo Vendors generated.");
            render();
        }

        // Init
        if (load(KEY_VEND, []).length === 0) seedVendors();
        render();
    </script>
</body>

</html>
