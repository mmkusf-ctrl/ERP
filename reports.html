<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Reports | Stark Premium ERP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- Top Navigation -->
  <header class="topbar">
    <div class="topbar-inner">
      <a href="dashboard.html" class="logo">
        <img src="images/stark-logo.png" alt="Stark Premium">
        <span class="logo-text">Stark ERP</span>
      </a>

      <nav class="nav">
        <a class="nav-link" href="dashboard.html">Overview</a>
        <a class="nav-link" href="item_master.html">Items</a>
        <a class="nav-link" href="crm.html">CRM</a>
        <a class="nav-link" href="inventory.html">Inventory</a>
        <a class="nav-link" href="accounting.html">Accounting</a>
        <a class="nav-link" href="orders.html">Orders</a>
        <a class="nav-link" href="logistics.html">Logistics</a>
        <a class="nav-link active" href="reports.html">Reports</a>
        <a class="nav-link" href="events.html">Events</a>
      </nav>

      <div style="display:flex; align-items:center; gap:12px;">
        <button class="btn btn-secondary" style="height:36px;" onclick="seedSales()">
          Load Demo Sales
        </button>
        <button class="hamburger" onclick="openMobileNav()">
          <span></span><span></span><span></span>
        </button>
      </div>
    </div>
  </header>

  <!-- Mobile Drawer -->
  <div class="mobile-nav" id="mobileNav">
    <div class="mobile-drawer">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
        <strong style="font-size:16px;">Navigation</strong>
        <button onclick="closeMobileNav()"
          style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
      </div>
      <a class="mobile-link" href="dashboard.html">Overview</a>
      <a class="mobile-link" href="item_master.html">Items</a>
      <a class="mobile-link" href="crm.html">CRM</a>
      <a class="mobile-link" href="inventory.html">Inventory</a>
      <a class="mobile-link" href="orders.html">Orders</a>
      <a class="mobile-link" href="logistics.html">Logistics</a>
      <a class="mobile-link active" href="reports.html">Reports</a>
      <a class="mobile-link" href="events.html">Events</a>
    </div>
  </div>

  <main class="container">
    <!-- Header -->
    <div class="page-header">
      <h1 class="page-title">REPORTS</h1>
      <div class="gold-line"></div>
    </div>

    <style>
      .report-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 20px 40px;
        /* Row gap, Col gap */
        margin-bottom: 40px;
      }

      .report-link {
        color: var(--primary);
        text-decoration: none;
        font-size: 13px;
        font-weight: 500;
        line-height: 1.4;
        display: block;
        border-bottom: 1px solid transparent;
      }

      .report-link:hover {
        text-decoration: underline;
        color: var(--primary-dark);
      }

      @media (max-width: 1400px) {
        .report-grid {
          grid-template-columns: repeat(4, 1fr);
        }
      }

      @media (max-width: 1000px) {
        .report-grid {
          grid-template-columns: repeat(3, 1fr);
        }
      }

      @media (max-width: 768px) {
        .report-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 480px) {
        .report-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>

    <div class="card" style="padding: 32px;">
      <div class="report-grid">
        <!-- Column 1 -->
        <div>
          <a href="#" class="report-link">Backorder Report</a><br>
          <a href="#" class="report-link">Brand Sales by Sku</a><br>
          <a href="#" class="report-link">Customer Sales by Brand</a><br>
          <a href="#" class="report-link">Inventory As Of A Specific Date</a><br>
          <a href="#" class="report-link">Item Stock / Sales Report</a><br>
          <a href="#" class="report-link">Pending Price Changes</a><br>
          <a href="#" class="report-link">RMA Reasons by Customer</a><br>
          <a href="#" class="report-link">Sales Rep Sales by Customer/Brand</a><br>
          <a href="#" class="report-link">Trigger Report</a><br>
          <a href="#" class="report-link">YTD Reports</a>
        </div>

        <!-- Column 2 -->
        <div>
          <a href="#" class="report-link">Backorder Report (new)</a><br>
          <a href="#" class="report-link">Bulk Label Log Report</a><br>
          <a href="#" class="report-link">Customer Trailing Data</a><br>
          <a href="#" class="report-link">Inventory Insurance Report</a><br>
          <a href="#" class="report-link">Items Not Sold in X Months Report</a><br>
          <a href="#" class="report-link">Price List</a><br>
          <a href="#" class="report-link">Sales by Customer</a><br>
          <a href="#" class="report-link">Shipping Profit Report</a><br>
          <a href="#" class="report-link">Trigger Reports</a>
        </div>

        <!-- Column 3 -->
        <div>
          <a href="#" class="report-link">Basic Brand Item Export</a><br>
          <a href="accounting.html" class="report-link">Cash Flow Report</a><br>
          <a href="#" class="report-link">Daily Order Metrics</a><br>
          <a href="#" class="report-link">Inventory Reconciling Reports</a><br>
          <a href="#" class="report-link">Missing Item Data Report</a><br>
          <a href="#" class="report-link">Profitability Report</a><br>
          <a href="#" class="report-link">Sales by State</a><br>
          <a href="#" class="report-link">Sub Category Report</a><br>
          <a href="vendor.html" class="report-link">Vendor Purchases Analysis</a>
        </div>

        <!-- Column 4 -->
        <div>
          <a href="#" class="report-link">Brand Detail Sales Report</a><br>
          <a href="#" class="report-link">Customer Order Counts</a><br>
          <a href="dashboard.html" class="report-link">Dashboard</a><br>
          <a href="#" class="report-link">Invoice Item Profit Report</a><br>
          <a href="#" class="report-link">Monthly Avg Item Sales</a><br>
          <a href="purchasing.html" class="report-link">Purchasing Power Cancellation Report</a><br>
          <a href="#" class="report-link">Sales by State Detail</a><br>
          <a href="#" class="report-link">Sub Report</a><br>
          <a href="#" class="report-link">Vendor Receiving Invoicing Variance Report</a>
        </div>

        <!-- Column 5 -->
        <div>
          <a href="#" class="report-link">Brand Order Counts by Customer</a><br>
          <a href="#" class="report-link">Customer Order Counts by Brand</a><br>
          <a href="#" class="report-link">Data Export</a><br>
          <a href="#" class="report-link">Item Availability Report</a><br>
          <a href="#" class="report-link">Open Orders Late</a><br>
          <a href="#" class="report-link">Receiving Report</a><br>
          <a href="#" class="report-link">Sales Order Cancellation Report</a><br>
          <a href="#" class="report-link">Top Sellers</a><br>
          <a href="#" class="report-link">Weekly Order Data</a>
        </div>

        <!-- Column 6 -->
        <div>
          <a href="#" class="report-link">Brand Sales by Customer</a><br>
          <a href="#" class="report-link">Customer Sales Analysis</a><br>
          <a href="accounting.html" class="report-link">Gross Margin Report</a><br>
          <a href="#" class="report-link">Item Sales Volume Report</a><br>
          <a href="#" class="report-link">Order Count 7 Day Avg</a><br>
          <a href="#" class="report-link">Rep Commission Report</a><br>
          <a href="#" class="report-link">Sales Rep Report</a><br>
          <a href="#" class="report-link">Trigger Brand Exclusions</a><br>
          <a href="accounting.html" class="report-link">Yearly Profit Review Report</a>
        </div>
      </div>
    </div>

    <div style="margin-top:40px; text-align:center; color:var(--text-muted); font-size:13px;">
      &copy; 2026 Stark Premium ERP.
    </div>
  </main>

  <div id="toastWrap" style="position:fixed; bottom:20px; right:20px; z-index:9999; display:grid; gap:10px;"></div>

  <script src="erp.js"></script>
  <script>
    const KEY_ITEMS = "stark_erp_items_v2"; // updated key from inventory.html
    const KEY_SALES = "stark_erp_sales_v1";

    function load(key, fallback) {
      try { return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }
      catch { return fallback; }
    }
    function save(key, data) { localStorage.setItem(key, JSON.stringify(data)); }
    function money(n) { return Number(n || 0).toLocaleString(undefined, { style: "currency", currency: "USD" }); }

    // Data init
    let items = load(KEY_ITEMS, []);
    let sales = load(KEY_SALES, []);

    function unique(arr) { return Array.from(new Set(arr)).filter(Boolean).sort(); }

    function initControls() {
      const skuSelect = document.getElementById("skuSelect");
      const locSelect = document.getElementById("locationSelect");

      // Populate SKU
      const skus = items.length ? items.map(i => i.sku) : unique(sales.map(s => s.sku));
      skuSelect.innerHTML = skus.length
        ? `<option value="">All SKUs</option>` + skus.map(s => `<option value="${s}">${s}</option>`).join("")
        : `<option value="">No SKUs Found</option>`;

      // Populate Locations
      const locs = unique(sales.map(s => s.location));
      locSelect.innerHTML = `<option value="">All Locations</option>` + locs.map(l => `<option value="${l}">${l}</option>`).join("");
    }

    function render() {
      // Reload newest data
      items = load(KEY_ITEMS, []);
      sales = load(KEY_SALES, []);

      const skuVal = document.getElementById("skuSelect").value;
      const rangeVal = Number(document.getElementById("rangeSelect").value);
      const locVal = document.getElementById("locationSelect").value;
      const custSearch = (document.getElementById("customerSearch").value || "").toLowerCase();

      const cutoff = new Date();
      cutoff.setDate(cutoff.getDate() - rangeVal);
      const cutoffTime = cutoff.getTime();

      let filtered = sales.filter(s => {
        if (new Date(s.date).getTime() < cutoffTime) return false;
        if (skuVal && s.sku !== skuVal) return false;
        if (locVal && s.location !== locVal) return false;
        if (custSearch && !s.customer.toLowerCase().includes(custSearch)) return false;
        return true;
      });

      filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

      // Calculate KPIs
      const totalUnits = filtered.reduce((acc, s) => acc + Number(s.qty), 0);
      const totalRev = filtered.reduce((acc, s) => acc + (Number(s.qty) * Number(s.unitPrice)), 0);
      const dailyAvg = totalUnits / Math.max(1, rangeVal);
      const forecast = Math.round(dailyAvg * 30);

      document.getElementById("kpiSales").textContent = filtered.length;
      document.getElementById("kpiSalesSub").textContent = skuVal || "All SKUs";
      document.getElementById("kpiUnits").textContent = totalUnits;
      document.getElementById("kpiRevenue").textContent = money(totalRev);
      document.getElementById("kpiForecast").textContent = forecast;

      // Render Table
      const tbody = document.getElementById("salesBody");
      tbody.innerHTML = "";

      if (!filtered.length) {
        tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; color:var(--text-muted);">No sales data in this range.</td></tr>`;
      } else {
        filtered.slice(0, 100).forEach(s => {
          const tr = document.createElement("tr");
          const total = Number(s.qty) * Number(s.unitPrice);
          tr.innerHTML = `
               <td>${new Date(s.date).toLocaleDateString()}</td>
               <td>${s.customer}</td>
               <td><span class="badge badge-green">${s.location}</span></td>
               <td>${s.orderId}</td>
               <td>${s.qty}</td>
               <td>${money(total)}</td>
             `;
          tbody.appendChild(tr);
        });
      }

      // Insights
      const bestCust = getTop(filtered, s => s.customer);
      const bestLoc = getTop(filtered, s => s.location);
      const bestDay = getTopDay(filtered);

      document.getElementById("insight1").innerHTML = `
          <strong style="display:block; font-size:13px;">Top Customer</strong>
          <span style="font-size:14px; margin-top:4px;">${bestCust || "—"}</span>
       `;
      document.getElementById("insight2").innerHTML = `
          <strong style="display:block; font-size:13px;">Top Region</strong>
          <span style="font-size:14px; margin-top:4px;">${bestLoc || "—"}</span>
       `;
      document.getElementById("insight3").innerHTML = `
          <strong style="display:block; font-size:13px;">Peak Sales Day</strong>
          <span style="font-size:14px; margin-top:4px;">${bestDay || "—"}</span>
       `;
    }

    function getTop(list, keyFn) {
      const m = {};
      list.forEach(item => {
        const k = keyFn(item);
        m[k] = (m[k] || 0) + Number(item.qty);
      });
      const sorted = Object.entries(m).sort((a, b) => b[1] - a[1]);
      return sorted.length ? `${sorted[0][0]} (${sorted[0][1]} units)` : null;
    }

    function getTopDay(list) {
      const m = {};
      list.forEach(item => {
        const d = new Date(item.date).toLocaleDateString();
        m[d] = (m[d] || 0) + Number(item.qty);
      });
      const sorted = Object.entries(m).sort((a, b) => b[1] - a[1]);
      return sorted.length ? `${sorted[0][0]} (${sorted[0][1]} units)` : null;
    }

    // Demo Data
    function seedSales() {
      // Generate random sales for last 6 months
      const newSales = [];
      const customers = [
        { name: "Asha Retail", loc: "Austin, TX" },
        { name: "Blue Harbor", loc: "Miami, FL" },
        { name: "Citrine Luxe", loc: "New York, NY" },
        { name: "Desert Pearl", loc: "Phoenix, AZ" },
        { name: "Emerald Lane", loc: "Seattle, WA" }
      ];
      const skus = items.length ? items.map(i => i.sku) : ["A-101", "B-202", "C-303"]; // fallback

      for (let i = 0; i < 150; i++) {
        const daysAgo = Math.floor(Math.random() * 90);
        const d = new Date(); d.setDate(d.getDate() - daysAgo);
        const c = customers[Math.floor(Math.random() * customers.length)];
        const sku = skus[Math.floor(Math.random() * skus.length)];

        newSales.push({
          date: d.toISOString(),
          customer: c.name,
          location: c.loc,
          sku: sku,
          qty: Math.floor(Math.random() * 15) + 1,
          unitPrice: 50 + Math.floor(Math.random() * 150),
          orderId: "ORD-" + Math.floor(Math.random() * 90000)
        });
      }

      sales = sales.concat(newSales);
      save(KEY_SALES, sales);
      toast("Success", "Loaded 150 demo sales records.");
      initControls();
      render();
    }

    function clearSales() {
      if (confirm("Delete all sales history?")) {
        save(KEY_SALES, []);
        render();
        toast("Cleared", "Sales history deleted.");
      }
    }

    // Init
    initControls();
    render();
  </script>
</body>
