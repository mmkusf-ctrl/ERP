<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Reports | Stark Premium ERP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css?v=2">

  <style>
    /* Report Links Grid */
    .report-index-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }

    .report-link {
      display: flex;
      align-items: center;
      padding: 16px 20px;
      color: var(--text-main);
      text-decoration: none;
      border-radius: 12px;
      transition: all 0.2s;
      font-size: 14px;
      font-weight: 600;
      background: white;
      border: 1px solid var(--border);
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      position: relative;
      overflow: hidden;
    }

    .report-link::before {
      content: "üìÑ";
      margin-right: 12px;
      font-size: 16px;
      opacity: 0.7;
    }

    .report-link:hover {
      background: #fff;
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      color: var(--primary);
    }

    .section-title {
      font-size: 16px;
      font-weight: 800;
      color: var(--text-subtle);
      margin: 40px 0 16px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      padding-bottom: 8px;
    }

    /* Interactive KPI Cards */
    .interactive-kpi:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
    }

    .interactive-kpi:active {
      transform: translateY(-2px) scale(1.01);
    }
  </style>
</head>

<body>
  <!-- Top Navigation -->
  <header class="topbar">
    <div class="topbar-inner">
      <a href="dashboard.html" class="logo">
        <img src="images/stark-logo.png" alt="Stark Premium">
        <span class="logo-text">Stark ERP</span>
      </a>

      <nav class="nav">
        <a class="nav-link" href="dashboard.html">Home</a>
        <a class="nav-link" href="master.html">Master</a>
        <a class="nav-link" href="crm.html">CRM</a>
        <a class="nav-link" href="vendor.html">Vendor</a>
        <a class="nav-link" href="purchasing.html">Purchasing</a>
        <a class="nav-link" href="inventory.html">Inventory</a>
        <a class="nav-link" href="accounting.html">Accounting</a>
        <a class="nav-link" href="orders.html">Orders</a>
        <a class="nav-link" href="logistics.html">Logistics</a>
        <a class="nav-link active" href="reports.html">Reports</a>
        <a class="nav-link" href="events.html">Events</a>
      </nav>

      <div style="display:flex; align-items:center; gap:12px;">
        <div class="badge badge-green" style="display:none; @media(min-width:700px){display:inline-flex;}">
          Online
        </div>
        <button class="hamburger" onclick="openMobileNav()">
          <span></span><span></span><span></span>
        </button>
      </div>
    </div>
  </header>

  <!-- Mobile Drawer -->
  <div class="mobile-nav" id="mobileNav">
    <div class="mobile-drawer">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
        <strong style="font-size:16px;">Navigation</strong>
        <button onclick="closeMobileNav()"
          style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
      </div>
      <a class="mobile-link" href="dashboard.html">Home</a>
      <a class="mobile-link" href="master.html">Master</a>
      <a class="mobile-link" href="crm.html">CRM</a>
      <a class="mobile-link" href="vendor.html">Vendor</a>
      <a class="mobile-link" href="purchasing.html">Purchasing</a>
      <a class="mobile-link" href="inventory.html">Inventory</a>
      <a class="mobile-link" href="accounting.html">Accounting</a>
      <a class="mobile-link" href="orders.html">Orders</a>
      <a class="mobile-link" href="logistics.html">Logistics</a>
      <a class="mobile-link active" href="reports.html">Reports</a>
      <a class="mobile-link" href="events.html">Events</a>
      <a class="mobile-link" href="trends.html">Trends</a>
    </div>
  </div>

  <main class="container" style="padding-top:40px;">
    <!-- Header -->
    <div class="page-header" style="margin-bottom:32px;">
      <h1 class="page-title" style="font-size:32px; font-weight:800; margin-bottom:8px; color:var(--text-main);">All
        Reports</h1>

      <div style="max-width:500px; position:relative;">
        <input id="reportSearch" class="input" placeholder="Filter reports..."
          style="border-radius:99px; padding-left:44px;" onkeyup="filterReports()" />
        <span style="position:absolute; left:16px; top:12px; opacity:0.5;">üîç</span>
      </div>
    </div>

    <!-- Admin-Only Financial KPIs -->
    <div id="adminFinancialKPIs" style="display:none; margin-bottom:32px;">
      <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(220px, 1fr)); gap:16px;">
        <!-- Total Receivables -->
        <div class="interactive-kpi" onclick="showKPIDetail('receivables')"
          style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white; padding:24px; border-radius:12px; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); cursor:pointer; transition:all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); position:relative;">
          <div
            style="position:absolute; top:12px; right:12px; font-size:10px; background:rgba(255,255,255,0.2); padding:4px 8px; border-radius:12px; font-weight:700;">
            <span style="color:#4ade80;">‚ñ≤ 12%</span>
          </div>
          <div
            style="font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; opacity:0.9; margin-bottom:8px;">
            üí∞ Receivables</div>
          <div style="font-size:28px; font-weight:800; margin-bottom:4px;" class="kpi-value" data-target="847520">$0
          </div>
          <div style="font-size:11px; opacity:0.8;">Outstanding invoices</div>
          <div style="font-size:9px; margin-top:8px; opacity:0.7;">Click for details ‚Üí</div>
        </div>

        <!-- Total Payables -->
        <div class="interactive-kpi" onclick="showKPIDetail('payables')"
          style="background:linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color:white; padding:24px; border-radius:12px; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); cursor:pointer; transition:all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); position:relative;">
          <div
            style="position:absolute; top:12px; right:12px; font-size:10px; background:rgba(255,255,255,0.2); padding:4px 8px; border-radius:12px; font-weight:700;">
            <span style="color:#4ade80;">‚ñº 3%</span>
          </div>
          <div
            style="font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; opacity:0.9; margin-bottom:8px;">
            üí≥ Payables</div>
          <div style="font-size:28px; font-weight:800; margin-bottom:4px;" class="kpi-value" data-target="423180">$0
          </div>
          <div style="font-size:11px; opacity:0.8;">Due to vendors</div>
          <div style="font-size:9px; margin-top:8px; opacity:0.7;">Click for details ‚Üí</div>
        </div>

        <!-- Daily Burn Rate -->
        <div class="interactive-kpi" onclick="showKPIDetail('burn')"
          style="background:linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color:white; padding:24px; border-radius:12px; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); cursor:pointer; transition:all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); position:relative;">
          <div
            style="position:absolute; top:12px; right:12px; font-size:10px; background:rgba(255,255,255,0.2); padding:4px 8px; border-radius:12px; font-weight:700;">
            <span style="color:#4ade80;">‚ñº 5%</span>
          </div>
          <div
            style="font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; opacity:0.9; margin-bottom:8px;">
            üìâ Daily Burn</div>
          <div style="font-size:28px; font-weight:800; margin-bottom:4px;" class="kpi-value" data-target="12450">$0
          </div>
          <div style="font-size:11px; opacity:0.8;">PO + Misc expenses/day</div>
          <div style="font-size:9px; margin-top:8px; opacity:0.7;">Click for details ‚Üí</div>
        </div>

        <!-- Dead Stock Value -->
        <div class="interactive-kpi" onclick="showKPIDetail('deadstock')"
          style="background:linear-gradient(135deg, #fa709a 0%, #fee140 100%); color:white; padding:24px; border-radius:12px; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); cursor:pointer; transition:all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); position:relative;">
          <div
            style="position:absolute; top:12px; right:12px; font-size:10px; background:rgba(255,255,255,0.2); padding:4px 8px; border-radius:12px; font-weight:700;">
            <span style="color:#ef4444;">‚ñ≤ 8%</span>
          </div>
          <div
            style="font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; opacity:0.9; margin-bottom:8px;">
            üî¥ Dead Stock</div>
          <div style="font-size:28px; font-weight:800; margin-bottom:4px;" class="kpi-value" data-target="89320">$0
          </div>
          <div style="font-size:11px; opacity:0.8;">Not sold in 6+ months</div>
          <div style="font-size:9px; margin-top:8px; opacity:0.7;">Click for details ‚Üí</div>
        </div>

        <!-- Total Inventory Value -->
        <div class="interactive-kpi" onclick="showKPIDetail('inventory')"
          style="background:linear-gradient(135deg, #30cfd0 0%, #330867 100%); color:white; padding:24px; border-radius:12px; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); cursor:pointer; transition:all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); position:relative;">
          <div
            style="position:absolute; top:12px; right:12px; font-size:10px; background:rgba(255,255,255,0.2); padding:4px 8px; border-radius:12px; font-weight:700;">
            <span style="color:#4ade80;">‚ñ≤ 15%</span>
          </div>
          <div
            style="font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; opacity:0.9; margin-bottom:8px;">
            üì¶ Inventory Value</div>
          <div style="font-size:28px; font-weight:800; margin-bottom:4px;" class="kpi-value" data-target="1200000">$0
          </div>
          <div style="font-size:11px; opacity:0.8;">Open POs + on-hand stock</div>
          <div style="font-size:9px; margin-top:8px; opacity:0.7;">Click for details ‚Üí</div>
        </div>
      </div>
    </div>

    <!-- Report Grid -->
    <div style="margin-top:24px;" id="reportsContainer">

      <div class="section-title">üí∞ Financial & Profitability</div>
      <div class="report-index-grid">
        <a href="report_view.html?id=cash_flow" class="report-link">Cash Flow Report</a>
        <a href="report_view.html?id=gross_margin" class="report-link">Gross Margin Report</a>
        <a href="report_view.html?id=profitability" class="report-link">Profitability Report</a>
        <a href="report_view.html?id=yearly_profit" class="report-link">Yearly Profit Review Report</a>
        <a href="report_view.html?id=invoice_item_profit" class="report-link">Invoice Item Profit Report</a>
        <a href="report_view.html?id=shipping_profit" class="report-link">Shipping Profit Report</a>
      </div>

      <div class="section-title">üìä Sales & Customers</div>
      <div class="report-index-grid">
        <a href="report_view.html?id=daily_order_metrics" class="report-link">Daily Order Metrics</a>
        <a href="report_view.html?id=weekly_order_data" class="report-link">Weekly Order Data</a>
        <a href="report_view.html?id=top_sellers" class="report-link">Top Sellers</a>
        <a href="report_view.html?id=sales_by_cust" class="report-link">Sales by Customer</a>
        <a href="report_view.html?id=sales_by_state" class="report-link">Sales by State</a>
        <a href="report_view.html?id=cust_sales_analysis" class="report-link">Customer Sales Analysis</a>
        <a href="report_view.html?id=cust_order_counts" class="report-link">Customer Order Counts</a>
        <a href="report_view.html?id=sales_rep_report" class="report-link">Sales Rep Performance</a>
      </div>

      <div class="section-title">üì¶ Inventory & Purchasing</div>
      <div class="report-index-grid">
        <a href="report_view.html?id=inventory_date" class="report-link">Inventory As Of Date</a>
        <a href="report_view.html?id=item_stock_sales" class="report-link">Item Stock / Sales Report</a>
        <a href="report_view.html?id=backorder_report" class="report-link">Backorder Report</a>
        <a href="report_view.html?id=items_not_sold" class="report-link">Dead Stock (Not Sold in X Months)</a>
        <a href="report_view.html?id=vendor_purchases" class="report-link">Vendor Purchases Analysis</a>
        <a href="report_view.html?id=receiving_report" class="report-link">Receiving Report</a>
      </div>

      <div class="section-title">üè∑Ô∏è Brands & Items</div>
      <div class="report-index-grid">
        <a href="report_view.html?id=brand_sales_sku" class="report-link">Brand Sales by SKU</a>
        <a href="report_view.html?id=brand_detail_sales" class="report-link">Brand Detail Sales Report</a>
        <a href="report_view.html?id=price_list" class="report-link">Master Price List</a>
        <a href="report_view.html?id=missing_item_data" class="report-link">Missing Item Data Report</a>
      </div>

      <div class="section-title">‚öôÔ∏è System & Logs</div>
      <div class="report-index-grid">
        <a href="report_view.html?id=data_export" class="report-link">Data Export History</a>
        <a href="report_view.html?id=bulk_label_log" class="report-link">Bulk Label Log Report</a>
        <a href="report_view.html?id=trigger_report" class="report-link">System Triggers Log</a>
      </div>

    </div>

    <div style="margin-top:40px; text-align:center; color:var(--text-muted); font-size:13px;">
      &copy; 2026 Stark Premium ERP. secure. fast. reliable.
    </div>

  </main>

  <script src="erp.js"></script>
  <script>
    const AUTH_KEY = "stark_erp_auth_v1";

    // Check if admin and show financial KPIs
    (function () {
      const AUTH_KEY = "stark_erp_auth_v1";
      try {
        const auth = JSON.parse(localStorage.getItem(AUTH_KEY) || "null");
        if (auth && auth.user && auth.user.toLowerCase() === 'admin') {
          document.getElementById('adminFinancialKPIs').style.display = 'block';

          // Calculate and update KPIs from real data
          calculateRealTimeKPIs();

          // Animate KPI values on load
          setTimeout(() => {
            animateKPIs();
          }, 300);
        }
      } catch (e) {
        console.log('No auth found');
      }
    })();

    // Calculate KPIs from real-time data
    function calculateRealTimeKPIs() {
      // Get all data from localStorage
      const items = JSON.parse(localStorage.getItem('stark_inventory') || '[]');
      const pos = JSON.parse(localStorage.getItem('stark_pos') || '[]');
      const orders = JSON.parse(localStorage.getItem('stark_orders') || '[]');

      // 1. Calculate Receivables (unpaid customer invoices/orders)
      let receivables = 0;
      orders.forEach(order => {
        if (order.status !== 'Completed' && order.status !== 'Cancelled') {
          const total = parseFloat(order.total || 0);
          receivables += total;
        }
      });

      // 2. Calculate Payables (open PO values)
      let payables = 0;
      let openPOValue = 0;
      pos.forEach(po => {
        if (po.status === 'Pending' || po.status === 'Partial') {
          const total = parseFloat(po.total || 0);
          payables += total;
          openPOValue += total;
        }
      });

      // 3. Calculate Daily Burn (PO + Misc expenses)
      const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
      let recentPOTotal = 0;
      let recentPOCount = 0;
      pos.forEach(po => {
        const createdAt = po.date ? new Date(po.date).getTime() : Date.now();
        if (createdAt > thirtyDaysAgo) {
          recentPOTotal += parseFloat(po.total || 0);
          recentPOCount++;
        }
      });
      const dailyBurn = recentPOCount > 0 ? Math.floor(recentPOTotal / 30) : 0;

      // 4. Calculate Dead Stock Value (items with low/zero movement)
      let deadStockValue = 0;
      items.forEach(item => {
        const qty = parseFloat(item.qty || 0);
        const price = parseFloat(item.price || 0);
        if (qty > 0 && qty < 5) { // Low stock items considered dead stock
          deadStockValue += (qty * price);
        }
      });

      // 5. Calculate Inventory Value (Open POs + On-Hand)
      let onHandValue = 0;
      items.forEach(item => {
        const qty = parseFloat(item.qty || 0);
        const price = parseFloat(item.price || 0);
        onHandValue += (qty * price);
      });
      const inventoryValue = openPOValue + onHandValue;

      // Update KPI cards with calculated values
      const kpiCards = document.querySelectorAll('.kpi-value');
      if (kpiCards[0]) kpiCards[0].setAttribute('data-target', Math.floor(receivables));
      if (kpiCards[1]) kpiCards[1].setAttribute('data-target', Math.floor(payables));
      if (kpiCards[2]) kpiCards[2].setAttribute('data-target', Math.floor(dailyBurn));
      if (kpiCards[3]) kpiCards[3].setAttribute('data-target', Math.floor(deadStockValue));
      if (kpiCards[4]) kpiCards[4].setAttribute('data-target', Math.floor(inventoryValue));

      // Store for detail view
      window.kpiData = {
        receivables: Math.floor(receivables),
        payables: Math.floor(payables),
        dailyBurn: Math.floor(dailyBurn),
        deadStockValue: Math.floor(deadStockValue),
        inventoryValue: Math.floor(inventoryValue),
        openPOValue: Math.floor(openPOValue),
        onHandValue: Math.floor(onHandValue)
      };
    }

    // Animate counter values
    function animateKPIs() {
      const kpiValues = document.querySelectorAll('.kpi-value');
      kpiValues.forEach(el => {
        const target = parseInt(el.getAttribute('data-target'));
        const duration = 1500;
        const start = 0;
        const increment = target / (duration / 16);
        let current = start;

        const timer = setInterval(() => {
          current += increment;
          if (current >= target) {
            current = target;
            clearInterval(timer);
          }

          // Format number with commas
          if (target >= 1000000) {
            el.textContent = '$' + (current / 1000000).toFixed(1) + 'M';
          } else {
            el.textContent = '$' + Math.floor(current).toLocaleString();
          }
        }, 16);
      });
    }

    // Show KPI detail modal
    function showKPIDetail(type) {
      const details = {
        receivables: {
          title: 'üí∞ Accounts Receivable',
          content: 'Total outstanding invoices: $847,520\n\nBreakdown:\n‚Ä¢ 0-30 days: $425,000\n‚Ä¢ 31-60 days: $312,000\n‚Ä¢ 61-90 days: $85,520\n‚Ä¢ 90+ days: $25,000'
        },
        payables: {
          title: 'üí≥ Accounts Payable',
          content: 'Total amount due to vendors: $423,180\n\nBreakdown:\n‚Ä¢ Due this week: $125,000\n‚Ä¢ Due this month: $198,180\n‚Ä¢ Due next month: $100,000'
        },
        burn: {
          title: 'üìâ Daily Burn Rate',
          content: 'Average daily spend (PO + Misc): $12,450\n\nBreakdown:\n‚Ä¢ Purchase Orders: $9,800\n‚Ä¢ Miscellaneous Expenses: $2,650\n\nNote: Only tracking PO and misc expenses'
        },
        deadstock: {
          title: 'üî¥ Dead Stock Value',
          content: 'Items not sold in 6+ months: $89,320\n\nTop categories:\n‚Ä¢ Electronics: $35,000\n‚Ä¢ Clothing: $28,500\n‚Ä¢ Accessories: $15,820\n‚Ä¢ Other: $10,000'
        },
        inventory: {
          title: 'üì¶ Total Inventory Value',
          content: 'Open POs + On-Hand Inventory: $1.2M\n\nBreakdown:\n‚Ä¢ Open Purchase Orders: $730,000\n‚Ä¢ On-Hand Inventory: $470,000\n\nNote: Combines pending POs and current stock value'
        }
      };

      const detail = details[type];
      if (detail) {
        alert(detail.title + '\n\n' + detail.content + '\n\n‚ú® Click OK to continue');
      }
    }

    function filterReports() {
      const input = document.getElementById('reportSearch');
      const filter = input.value.toUpperCase();
      const links = document.querySelectorAll('.report-link');
      const sections = document.querySelectorAll('.section-title');

      links.forEach(link => {
        const txt = link.innerText;
        if (txt.toUpperCase().indexOf(filter) > -1) {
          link.style.display = "";
        } else {
          link.style.display = "none";
        }
      });

      // Hide empty sections? (Optional enhancement, skipping for simplicity to keep it fast)
    }
  </script>
</body>

</html>
