<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Events | Stark Premium ERP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--border);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .calendar-header {
            background: #f8fafc;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 13px;
            color: var(--text-muted);
        }

        .calendar-day {
            background: white;
            min-height: 100px;
            padding: 8px;
            position: relative;
        }

        .calendar-day:hover {
            background: #f8fafc;
        }

        .day-num {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .event-chip {
            font-size: 11px;
            padding: 4px 6px;
            border-radius: 4px;
            margin-bottom: 2px;
            background: var(--primary-light);
            color: var(--primary);
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .event-chip.urgent {
            background: #fef2f2;
            color: var(--danger);
        }

        .event-chip.warning {
            background: #fffbeb;
            color: #d97706;
        }
    </style>
</head>

<body>
    <!-- Top Navigation -->
    <header class="topbar">
        <div class="topbar-inner">
            <a href="dashboard.html" class="logo">
                <img src="images/stark-logo.png" alt="Stark Premium">
                <span class="logo-text">Stark ERP</span>
            </a>

            <nav class="nav">
                <a class="nav-link" href="dashboard.html">Overview</a>
                <a class="nav-link" href="crm.html">CRM</a>
                <a class="nav-link" href="vendor.html">Vendor</a>
                <a class="nav-link" href="purchasing.html">Purchasing</a>
                <a class="nav-link" href="inventory.html">Inventory</a>
                <a class="nav-link" href="accounting.html">Accounting</a>
                <a class="nav-link" href="orders.html">Orders</a>
                <a class="nav-link" href="logistics.html">Logistics</a>
                <a class="nav-link" href="reports.html">Reports</a>
                <a class="nav-link active" href="events.html">Events</a>
            </nav>

            <div style="display:flex; align-items:center; gap:12px;">
                <div class="badge badge-green" style="display:none; @media(min-width:700px){display:inline-flex;}">
                    Online
                </div>
                <button class="hamburger" onclick="openMobileNav()">
                    <span></span><span></span><span></span>
                </button>
            </div>
        </div>
    </header>

    <div class="mobile-nav" id="mobileNav">
        <div class="mobile-drawer">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                <strong style="font-size:16px;">Navigation</strong>
                <button onclick="closeMobileNav()"
                    style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
            </div>
            <a class="mobile-link" href="dashboard.html">Overview</a>
            <a class="mobile-link" href="crm.html">CRM</a>
            <a class="mobile-link" href="vendor.html">Vendor</a>
            <a class="mobile-link" href="purchasing.html">Purchasing</a>
            <a class="mobile-link" href="inventory.html">Inventory</a>
            <a class="mobile-link" href="accounting.html">Accounting</a>
            <a class="mobile-link" href="orders.html">Orders</a>
            <a class="mobile-link" href="logistics.html">Logistics</a>
            <a class="mobile-link" href="reports.html">Reports</a>
            <a class="mobile-link active" href="events.html">Events</a>
        </div>
    </div>

    <main class="container">
        <!-- Header -->
        <div style="display:flex; justify-content:space-between; align-items:flex-end; margin-bottom:24px;">
            <div>
                <h1 class="page-title">Events</h1>
                <p class="page-desc">Schedule, manage, and track upcoming company-wide events and deadlines.</p>
            </div>
            <button class="btn btn-primary" onclick="openEventModal()" style="padding:10px 24px; font-weight:600;">+ Add
                Event</button>
        </div>

        <!-- Stats Row -->
        <div
            style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:16px; margin-bottom:32px;">
            <div class="card click-action" onclick="setFilter('All', this)"
                style="background:#fffbeb; border:1px solid #fcd34d; color:#d97706; padding:16px; display:flex; gap:10px; align-items:center; cursor:pointer;">
                <span style="font-size:24px; font-weight:700;">18</span>
                <span style="font-weight:600;">Upcoming</span>
            </div>
            <div class="card click-action" onclick="setFilter('Urgent', this)"
                style="background:#fff1f2; border:1px solid #fda4af; color:#e11d48; padding:16px; display:flex; gap:10px; align-items:center; cursor:pointer;">
                <span style="font-size:24px; font-weight:700;">9</span>
                <span style="font-weight:600;">Urgent</span>
            </div>
            <div class="card click-action" onclick="setFilter('Confirmed', this)"
                style="background:#f0fdf4; border:1px solid #86efac; color:#16a34a; padding:16px; display:flex; gap:10px; align-items:center; cursor:pointer;">
                <span style="font-size:24px; font-weight:700;">2</span>
                <span style="font-weight:600;">Confirmed</span>
            </div>
            <div class="card click-action" onclick="setFilter('Draft', this)"
                style="background:#f5f3ff; border:1px solid #c4b5fd; color:#7c3aed; padding:16px; display:flex; gap:10px; align-items:center; cursor:pointer;">
                <span style="font-size:24px; font-weight:700;">4</span>
                <span style="font-weight:600;">Draft</span>
            </div>
        </div>

        <!-- Controls -->
        <div
            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; flex-wrap:wrap; gap:16px;">
            <div style="display:flex; gap:8px;" id="filterContainer">
                <button class="btn btn-primary" onclick="setFilter('All', this)"
                    style="height:36px; border-radius:18px;">All</button>
                <button class="btn btn-secondary" onclick="setFilter('Today', this)"
                    style="height:36px; border-radius:18px; border:none; background:transparent;">Today</button>
                <button class="btn btn-secondary" onclick="setFilter('Tomorrow', this)"
                    style="height:36px; border-radius:18px; border:none; background:transparent;">Tomorrow</button>
                <button class="btn btn-secondary" onclick="setFilter('Week', this)"
                    style="height:36px; border-radius:18px; border:none; background:transparent;">This Week</button>
            </div>
            <div style="position:relative;">
                <input class="input" placeholder="Search" style="padding-left:32px; width:250px; border-radius:20px;"
                    oninput="searchEvents(this.value)" />
                <span
                    style="position:absolute; left:12px; top:50%; transform:translateY(-50%); color:var(--text-muted);">üîç</span>
            </div>
        </div>

        <div class="grid" style="display:grid; grid-template-columns: 3fr 1fr; gap:24px; align-items:start;">
            <!-- Left: List View -->
            <div class="card" style="padding:0; overflow:hidden;">
                <table style="width:100%; border-collapse:collapse;">
                    <thead>
                        <tr style="background:#f8fafc; border-bottom:1px solid var(--border); text-align:left;">
                            <th style="padding:16px; font-size:12px; color:var(--text-muted); font-weight:600;">EVENT
                                DATE</th>
                            <th style="padding:16px; font-size:12px; color:var(--text-muted); font-weight:600;">EVENT
                            </th>
                            <th style="padding:16px; font-size:12px; color:var(--text-muted); font-weight:600;">CUSTOMER
                                / LOCATION</th>
                            <th style="padding:16px; font-size:12px; color:var(--text-muted); font-weight:600;">STATUS
                            </th>
                        </tr>
                    </thead>
                    <tbody id="eventListBody">
                        <!-- Filled by JS -->
                    </tbody>
                </table>
            </div>

            <!-- Right: Calendar Sidebar -->
            <aside style="display:grid; gap:24px; position:sticky; top:20px;">
                <div class="card" style="text-align:center;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                        <h3 style="margin:0; font-size:16px;">April 2026</h3>
                        <div style="font-size:12px; color:var(--text-muted); cursor:pointer;">Today</div>
                    </div>
                    <div style="display:grid; grid-template-columns:repeat(7, 1fr); gap:8px; font-size:12px;">
                        <div style="color:var(--text-muted);">Su</div>
                        <div style="color:var(--text-muted);">Mo</div>
                        <div style="color:var(--text-muted);">Tu</div>
                        <div style="color:var(--text-muted);">We</div>
                        <div style="color:var(--text-muted);">Th</div>
                        <div style="color:var(--text-muted);">Fr</div>
                        <div style="color:var(--text-muted);">Sa</div>

                        <!-- Calendar Days (Static Mock Logic for Visuals) -->
                        <div style="padding:6px; color:#cbd5e1;">30</div>
                        <div style="padding:6px; color:#cbd5e1;">31</div>
                        <div style="padding:6px;">1</div>
                        <div style="padding:6px;">2</div>
                        <div style="padding:6px;">3</div>
                        <div style="padding:6px;">4</div>
                        <div style="padding:6px;">5</div>
                        <div style="padding:6px;">6</div>
                        <div style="padding:6px;">7</div>
                        <div style="padding:6px;">8</div>
                        <div style="padding:6px;">9</div>
                        <div style="padding:6px; background:var(--primary); color:white; border-radius:50%;">10</div>
                        <div style="padding:6px;">11</div>
                        <div style="padding:6px;">12</div>
                        <div style="padding:6px;">13</div>
                        <div style="padding:6px;">14</div>
                        <div style="padding:6px;">15</div>
                        <div style="padding:6px;">16</div>
                        <div style="padding:6px;">17</div>
                        <div style="padding:6px;">18</div>
                        <div style="padding:6px;">19</div>
                        <div style="padding:6px;">20</div>
                        <div style="padding:6px;">21</div>
                        <div style="padding:6px;">22</div>
                        <div style="padding:6px;">23</div>
                        <div style="padding:6px;">24</div>
                        <div style="padding:6px;">25</div>
                        <div style="padding:6px;">26</div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin:0 0 16px 0; font-size:16px;">Today's Summary</h3>
                    <div style="font-size:13px; color:var(--text-muted); line-height:1.6;">
                        You have <strong>4 events</strong> scheduled for today. <br>
                        2 are confirmed, 1 is draft.
                    </div>
                </div>
            </aside>
        </div>

        <div style="margin-top:40px; text-align:center; color:var(--text-muted); font-size:13px;">
            &copy; 2026 Stark Premium ERP.
        </div>
    </main>

    <!-- Create Event Modal (Preserved) -->
    <div class="mobile-nav" id="eventModal" style="z-index:900;">
        <div class="card"
            style="position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); width:min(90%, 600px); max-height:90vh; overflow-y:auto; box-shadow:var(--shadow-card);">
            <div
                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding-bottom:12px; border-bottom:1px solid var(--border);">
                <h3 style="margin:0;">Create New Event</h3>
                <button onclick="closeEventModal()"
                    style="border:none; background:transparent; font-size:24px; cursor:pointer;">&times;</button>
            </div>

            <div style="display:grid; gap:16px;">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:16px;">
                    <div>
                        <label
                            style="font-size:12px; font-weight:700; color:var(--text-muted); text-transform:uppercase;">Customer
                            Name</label>
                        <input id="eCustomer" class="input" placeholder="e.g. Acme Corp" />
                    </div>
                    <div>
                        <label
                            style="font-size:12px; font-weight:700; color:var(--text-muted); text-transform:uppercase;">Event
                            Name</label>
                        <input id="eName" class="input" placeholder="e.g. Summer Gala" />
                    </div>
                </div>
                <div>
                    <label
                        style="font-size:12px; font-weight:700; color:var(--text-muted); text-transform:uppercase;">Ship
                        To Address</label>
                    <input id="eAddress" class="input" placeholder="123 Main St, City, State" />
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:16px;">
                    <div>
                        <label
                            style="font-size:12px; font-weight:700; color:var(--text-muted); text-transform:uppercase;">In
                            Hands Date</label>
                        <input id="eDate" type="date" class="input" />
                    </div>
                    <div>
                        <label
                            style="font-size:12px; font-weight:700; color:var(--text-muted); text-transform:uppercase;">Delivery
                            Method</label>
                        <select id="eDelivery" class="input">
                            <option value="ASAP">ASAP (Ship Immediately)</option>
                            <option value="HOLD">HOLD (Do Not Ship)</option>
                        </select>
                    </div>
                </div>
                <div
                    style="background:#f8fafc; padding:12px; border-radius:var(--radius-md); border:1px solid var(--border);">
                    <label
                        style="font-size:12px; font-weight:700; color:var(--text-muted); text-transform:uppercase; display:block; margin-bottom:8px;">Add
                        Items</label>
                    <div style="display:flex; gap:8px; margin-bottom:8px;">
                        <input id="iSku" class="input" placeholder="SKU / Item Name" style="flex:2;" />
                        <input id="iQty" type="number" class="input" placeholder="Qty" style="flex:1;" />
                        <button class="btn btn-secondary" onclick="addItemRow()">+</button>
                    </div>
                    <div id="itemList" style="display:grid; gap:4px; max-height:100px; overflow-y:auto;">
                        <div style="font-size:13px; color:var(--text-muted); font-style:italic; padding:4px;">No items
                            added yet.</div>
                    </div>
                </div>
                <div>
                    <label
                        style="font-size:12px; font-weight:700; color:var(--text-muted); text-transform:uppercase;">Special
                        Instructions</label>
                    <textarea id="eInstr" class="input" rows="3"
                        placeholder="Gate code, packing requirements, etc."></textarea>
                </div>
                <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:8px;">
                    <button class="btn btn-secondary" onclick="closeEventModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveEvent()">Create Event</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toastWrap" style="position:fixed; bottom:20px; right:20px; z-index:9999; display:grid; gap:10px;"></div>

    <script src="erp.js"></script>
    <script>
        const AUTH_KEY = "stark_erp_auth_v1";
        const EVENTS_KEY = "stark_erp_events_v1";

        (function () { try { const a = JSON.parse(localStorage.getItem(AUTH_KEY) || "null"); if (!a || !a.user) window.location.href = "index.html"; } catch { window.location.href = "index.html"; } })();

        function openMobileNav() { document.getElementById("mobileNav").classList.add("open"); }
        function closeMobileNav() { document.getElementById("mobileNav").classList.remove("open"); }
        function openEventModal() { document.getElementById("eventModal").classList.add("open"); }
        function closeEventModal() { document.getElementById("eventModal").classList.remove("open"); }

        // Item Logic
        let currentItems = [];
        function addItemRow() {
            const sku = document.getElementById("iSku").value.trim();
            const qty = document.getElementById("iQty").value.trim();
            if (!sku || !qty) return;
            currentItems.push({ sku, qty });
            renderItems();
            document.getElementById("iSku").value = ""; document.getElementById("iQty").value = ""; document.getElementById("iSku").focus();
        }
        function removeItem(idx) { currentItems.splice(idx, 1); renderItems(); }
        function renderItems() {
            const list = document.getElementById("itemList");
            if (currentItems.length === 0) { list.innerHTML = `<div style="font-size:13px; color:var(--text-muted); font-style:italic; padding:4px;">No items added yet.</div>`; return; }
            list.innerHTML = currentItems.map((item, idx) => `
                <div style="display:flex; justify-content:space-between; align-items:center; background:white; padding:6px 10px; border:1px solid var(--border); border-radius:4px; font-size:13px;">
                    <div><strong>${item.sku}</strong> <span style="color:var(--text-muted);">x${item.qty}</span></div>
                    <button onclick="removeItem(${idx})" style="border:none; background:transparent; color:var(--danger); cursor:pointer;">&times;</button>
                </div>`).join("");
        }

        function saveEvent() {
            const customer = document.getElementById("eCustomer").value;
            const name = document.getElementById("eName").value;
            const address = document.getElementById("eAddress").value;
            const date = document.getElementById("eDate").value;
            const delivery = document.getElementById("eDelivery").value;
            const instr = document.getElementById("eInstr").value;
            if (!customer || !name || !date) return alert("Required fields missing.");

            const newEvent = { id: "EVT-" + Date.now(), customer, name, address, date, delivery, instr, items: currentItems, status: "Scheduled" };
            const events = JSON.parse(localStorage.getItem(EVENTS_KEY) || "[]");
            events.push(newEvent);
            localStorage.setItem(EVENTS_KEY, JSON.stringify(events));

            closeEventModal();
            currentItems = []; renderItems(); document.querySelectorAll("input, textarea").forEach(i => i.value = "");
            renderEvents();
            alert("Event Scheduled!");
        }

        function setFilter(type, btn) {
            window.currentFilter = type;

            // Visual Update if it's a pill button (ignore if it's a card)
            if (btn.tagName === 'BUTTON') {
                const container = document.getElementById("filterContainer");
                Array.from(container.children).forEach(b => {
                    b.className = "btn btn-secondary";
                    b.style.background = "transparent";
                    b.style.color = "var(--text-muted)";
                });
                btn.className = "btn btn-primary";
                btn.style.background = "var(--primary)";
                btn.style.color = "white";
            }

            renderEvents();
        }

        function renderEvents() {
            const events = JSON.parse(localStorage.getItem(EVENTS_KEY) || "[]");
            const tbody = document.getElementById("eventListBody");
            const term = (window.searchTerm || "").toLowerCase();
            const filter = window.currentFilter || "All";

            events.sort((a, b) => new Date(a.date) - new Date(b.date));

            tbody.innerHTML = "";

            // Date Logic
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);

            const nextWeek = new Date(today);
            nextWeek.setDate(today.getDate() + 7);

            let visibleCount = 0;

            events.forEach(e => {
                // Search
                if (term && !(e.name + e.customer).toLowerCase().includes(term)) return;

                // Time Filter
                const d = new Date(e.date + "T00:00:00"); // Fix timezone offset
                if (filter === "Today") {
                    if (d.getTime() !== today.getTime()) return;
                } else if (filter === "Tomorrow") {
                    if (d.getTime() !== tomorrow.getTime()) return;
                } else if (filter === "Week") {
                    if (d < today || d > nextWeek) return;
                }

                // Status/Category Filter
                if (filter === 'Urgent' && e.delivery !== 'HOLD') return; // Mapping Urgent -> HOLD for demo
                if (filter === 'Confirmed' && e.delivery !== 'ASAP') return; // Mapping Confirmed -> ASAP
                if (filter === 'Draft' && e.status !== 'Draft') return; // Mapping Draft status

                visibleCount++;
                const month = d.toLocaleString('default', { month: 'short' });
                const day = d.getDate();
                const year = d.getFullYear();

                const badgeClass = e.delivery === 'HOLD' ? 'badge-red' : 'badge-green';
                const statusText = e.delivery === 'HOLD' ? 'Partially Filled' : 'Filled';
                const bg = e.delivery === 'HOLD' ? '#fef2f2' : '#f0fdf4';
                const border = e.delivery === 'HOLD' ? '#fecaca' : '#bbf7d0';

                tbody.innerHTML += `
                    <tr style="border-bottom:1px solid var(--border);">
                        <td style="padding:16px;">
                            <div style="font-weight:700; color:var(--text-main); font-size:14px;">${month} ${day}, ${year}</div>
                        </td>
                        <td style="padding:16px;">
                            <div style="display:flex; align-items:center; gap:12px;">
                                <div style="width:32px; height:32px; background:#e0e7ff; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:700; color:var(--primary);">
                                    ${e.name.substring(0, 2).toUpperCase()}
                                </div>
                                <div>
                                    <div style="font-weight:600; color:var(--text-main); font-size:14px;">${escapeHtml(e.name)}</div>
                                    <div style="font-size:12px; color:var(--text-muted);">ID: #${e.id.slice(-4)}</div>
                                </div>
                            </div>
                        </td>
                        <td style="padding:16px;">
                            <div style="font-weight:600; color:var(--text-main); font-size:14px;">${escapeHtml(e.customer)}</div>
                            <div style="font-size:12px; color:var(--text-muted);">${escapeHtml(e.address)}</div>
                        </td>
                        <td style="padding:16px;">
                            <span style="background:${bg}; border:1px solid ${border}; color:${e.delivery === 'HOLD' ? '#dc2626' : '#16a34a'}; padding:4px 8px; border-radius:6px; font-size:12px; font-weight:600;">
                                ${statusText}
                            </span>
                        </td>
                    </tr>
                `;
            });

            if (visibleCount === 0) {
                tbody.innerHTML = `<tr><td colspan="4" style="padding:32px; text-align:center; color:var(--text-muted);">No events found for this filter.</td></tr>`;
            }
        }

        function searchEvents(val) {
            window.searchTerm = val;
            renderEvents();
        }

        // Init
        renderEvents();
    </script>
</body>

</html>
